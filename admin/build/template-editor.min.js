var G=Object.defineProperty;var s=(j,$)=>G(j,"name",{value:$,configurable:!0});(function(){"use strict";(function(){const e={NODE_ENV:"production"};try{if(process){process.env=Object.assign({},process.env),Object.assign(process.env,e);return}}catch{}globalThis.process={env:e}})();var j=Object.defineProperty,$=s((e,t)=>j(e,"name",{value:t,configurable:!0}),"t");const A="tangibleTemplateEditorState",C=Object.assign({tab:void 0,postId:0,theme:"default",fontFamily:"default",fontSize:14,previewOpen:!1},S()||{});function F(e){window.localStorage&&(Object.assign(C,e),window.localStorage.setItem(A,JSON.stringify(C)))}s(F,"setMemory"),$(F,"setMemory");function S(){if(!window.localStorage)return;let e=window.localStorage.getItem(A);if(e)try{return e=JSON.parse(e),e}catch{}}s(S,"getMemory"),$(S,"getMemory");var J=Object.defineProperty,V=s((e,t)=>J(e,"name",{value:t,configurable:!0}),"g");function k({$:e,postId:t,$postForm:w,editorInstances:g,setEditorActiveForPreview:b}){const h=w.find(".tangible-template-tab-selector"),E=w.find(".tangible-template-tab"),u=[];if(!E.length){console.warn("No tabs elements found for Tangible Template code editor");return}h.on("click",function(){if(e(this).data("tabName")==="preview")return;const l=this;h.each(function(a){const f=e(this),d=f.data("tabName");if(d==="preview")return;const v=E.eq(a);if(this!==l){f.removeClass("active"),v.hide();return}f.addClass("active"),v.show();const o=v.find("[data-tangible-template-editor-type]"),r=o.length?g[o.attr("name")]:!1;u[a]||(u[a]=!0,r&&r.refresh()),r?(r.focus(),b()):b(!1),F({tab:d,postId:t})})});const c=window.location.search.substr(1).split("&").reduce(function(l,a){const[f,d]=a.split("=");return l[f]=d,l},{}).tab||C.postId===t&&C.tab;if(c){const l=h.filter(`[data-tab-name="${c}"]`);l.length&&l.eq(0).click()}}s(k,"handleTabs"),V(k,"handleTabs");var q=Object.defineProperty,N=s((e,t)=>q(e,"name",{value:t,configurable:!0}),"o");async function x({$:e,save:t,$editors:w,editorInstances:g,createCodeEditor:b,templateMeta:h,Tangible:E}){const u={onSave:t,viewportMargin:1/0,resizable:!1,lineWrapping:!0,extraKeys:{"Alt-F":"findPersistent","Ctrl-S":t,"Cmd-S":t,Tab:"emmetExpandAbbreviation",Esc:"emmetResetAbbreviation",Enter:"emmetInsertLineBreak","Ctrl-Space":"autocomplete"}};async function c(a){const f=e(a),d=f.attr("name"),v=f.data("tangibleTemplateEditorType"),o={...u,language:v};v==="html"&&(o.emmet={preview:!1});const r=g[d]=await b(a,o);r.setSize(null,"100%"),d==="post_content"&&!h.isNewPost&&r.focus(),a.editor=r,r.save=t,r.codeMirror6}s(c,"y"),N(c,"create");const l=[];w.each(function(){l.push(c(this))}),await Promise.all(l)}s(x,"createEditors"),N(x,"createEditors");var L=Object.defineProperty,O=s((e,t)=>L(e,"name",{value:t,configurable:!0}),"s");function M({$preview:e,$previewButton:t,ajax:w,postId:g,getEditorFields:b,getAdditionalFields:h,setMemory:E}){function u(o,r){o.contentWindow.document,o.contentWindow.document.open(),o.contentWindow.document.write(`<!DOCTYPE html>${r}`),o.contentWindow.document.close()}s(u,"d"),O(u,"setIframeContent");let c=!1,l=!1;function a(){l=!0}s(a,"g"),O(a,"scheduleRenderPreview"),setInterval(function(){l&&(l=!1,c&&f())},2e3);async function f(){const o=e[0],r={id:g,content:"",...b(),...h()};let p=o.getElementsByTagName("iframe")[0];p||(p=document.createElement("iframe"),p.style.width="100%",p.style.height="100%",p.style.minHeight="240px",p.style.border="none",p.style.borderRadius=".5rem",p.style.backgroundColor="#fff",o.style.resize="vertical",o.style.overflowY="auto",o.appendChild(p)),w("tangible_template_editor_render",r).then(function(_){u(p,_.result)}).catch(function(_){u(p,`<p>${_.message}</p>`)})}s(f,"f"),O(f,"renderPreview");let d=!0;t.on("click",function(){const o=!t.hasClass("active");d&&e.toggle(),o?(t.addClass("active"),c=!0,d&&f()):(t.removeClass("active"),c=!1),E({previewOpen:o})});function v(o=!0){d=o,o?c&&!e.is(":visible")&&e.show():c&&e.is(":visible")&&e.hide()}return s(v,"P"),O(v,"setEditorActiveForPreview"),{scheduleRenderPreview:a,setEditorActiveForPreview:v}}s(M,"createPreviewPane"),O(M,"createPreviewPane");var Y=Object.defineProperty,T=s((e,t)=>Y(e,"name",{value:t,configurable:!0}),"c");window.jQuery(function(e){const t=e("#post"),w=t.find("[data-tangible-template-editor-type]");if(!w.length){console.warn("No editor elements found for Tangible Template code editor");return}const{wp:g}=window;g&&g.autosave&&g.autosave.server&&g.autosave.server.postChanged&&(g.autosave.server.postChanged=function(){return!1});const{Tangible:b}=window,{ajax:h,createCodeEditor:E}=b;b.codeEditors=[];const u={},c=e("#post_ID").val(),l=t.find('input[name="post_title"]'),a=e("#publish"),f=a.closest("#major-publishing-actions"),d=t.find("#tangible-template-editor-meta").data("json")||{},v=["name","assets","location","theme_position","theme_header","theme_footer","universal_id","atomic_css"],o={};for(const i of v){const n=t.find(`[name="${i}"]`);n.length&&(o[i]=n)}const r=["tangible_template_category"],p={};for(const i of r){const n=t.find(`[type="checkbox"][name="tax_input[${i}][]"]`);n.length&&(p[i]=n,n.each(function(){const m=this.getAttribute("checked")==="checked";e(this).prop("checked",m)}))}const _=T(function(i,n=""){a.val(i),n?f.append(`<div id="post-save-error-message" style="padding-top: 8px">${n}</div>`):f.find("#post-save-error-message").remove()},"updatePublishButton"),B=T(function(){const i={};for(let n in u){const m=u[n];n==="post_content"&&(n="content");const y=m.getValue();i[n]=y}return i},"getEditorFields"),R=T(function(){const i={};for(const n of v)o[n]&&(i[n]=o[n].val());return i},"getAdditionalFields"),H=T(function(){const i={};for(const n of r)p[n]&&(i[n]=[],p[n].each(function(){const m=e(this);m.prop("checked")&&i[n].push(m.val())}));return i},"getTaxonomyFields");function W(){if(d.isNewPost){a.click();return}if(!c)return;const i=l.val();if(!i)return;const n={title:i,id:c,content:"",...B(),...R(),tax_input:H()},m=a.val();let y;function P(){y&&clearTimeout(y),y=setTimeout(function(){a.val(m)},7e3)}s(P,"a"),T(P,"restorePreviousLabelAfterTimeout"),h("tangible_template_editor_save",n).then(function(D){_("Saved"),P()}).catch(function(D){_("Error",D.message),P()})}s(W,"A"),T(W,"save"),!d.isNewPost&&d.postStatus;const K=t.find(".tangible-template-preview-pane"),I=t.find(".tangible-template-tab-selector[data-tab-name=preview]"),{scheduleRenderPreview:z,setEditorActiveForPreview:Q}=M({$preview:K,$previewButton:I,ajax:h,postId:c,getEditorFields:B,getAdditionalFields:R,setMemory:F});x({$:e,save:W,$editors:w,editorInstances:u,createCodeEditor:E,templateMeta:d,Tangible:b}).finally(function(){const i=t.find('[name="atomic_css"]'),n=window.Tangible.createAtomicCssEngine?window.Tangible.createAtomicCssEngine():null,m=u.post_content;n&&m&&i.length?(m.generateCss=async function(){const y=await n.parse(m.getValue());i.val(JSON.stringify(y))},m.generateCss().then(()=>{C.previewOpen&&I.click()})):C.previewOpen&&I.click();for(const[y,P]of Object.entries(u))P.generateCss?P?.on("change",()=>{P.generateCss().then(z)}):P?.on("change",z);k({$:e,postId:c,$postForm:t,editorInstances:u,setEditorActiveForPreview:Q})})})})();
//# sourceMappingURL=template-editor.min.js.map
