var G=Object.defineProperty;var r=(j,C)=>G(j,"name",{value:C,configurable:!0});(function(){"use strict";(function(){const e={NODE_ENV:"production"};try{if(process){process.env=Object.assign({},process.env),Object.assign(process.env,e);return}}catch{}globalThis.process={env:e}})();var j=Object.defineProperty,C=r((e,t)=>j(e,"name",{value:t,configurable:!0}),"t");const O="tangibleTemplateEditorState",T=Object.assign({tab:void 0,postId:0,theme:"default",fontFamily:"default",fontSize:14,previewOpen:!1},S()||{});function F(e){window.localStorage&&(Object.assign(T,e),window.localStorage.setItem(O,JSON.stringify(T)))}r(F,"setMemory"),C(F,"setMemory");function S(){if(!window.localStorage)return;let e=window.localStorage.getItem(O);if(e)try{return e=JSON.parse(e),e}catch{}}r(S,"getMemory"),C(S,"getMemory");var D=Object.defineProperty,q=r((e,t)=>D(e,"name",{value:t,configurable:!0}),"g");function A({$:e,postId:t,$postForm:h,editorInstances:m,setEditorActiveForPreview:g}){const b=h.find(".tangible-template-tab-selector"),y=h.find(".tangible-template-tab"),p=[];if(!y.length){console.warn("No tabs elements found for Tangible Template code editor");return}b.on("click",function(){if(e(this).data("tabName")==="preview")return;const l=this;b.each(function(a){const u=e(this),d=u.data("tabName");if(d==="preview")return;const v=y.eq(a);if(this!==l){u.removeClass("active"),v.hide();return}u.addClass("active"),v.show();const o=v.find("[data-tangible-template-editor-type]"),s=o.length?m[o.attr("name")]:!1;p[a]||(p[a]=!0,s&&s.refresh()),s?(s.focus(),g()):g(!1),F({tab:d,postId:t})})});const c=window.location.search.substr(1).split("&").reduce(function(l,a){const[u,d]=a.split("=");return l[u]=d,l},{}).tab||T.postId===t&&T.tab;if(c){const l=b.filter(`[data-tab-name="${c}"]`);l.length&&l.eq(0).click()}}r(A,"handleTabs"),q(A,"handleTabs");var J=Object.defineProperty,k=r((e,t)=>J(e,"name",{value:t,configurable:!0}),"o");async function N({$:e,save:t,$editors:h,editorInstances:m,createCodeEditor:g,templateMeta:b,Tangible:y}){const p={onSave:t,viewportMargin:1/0,resizable:!1,lineWrapping:!0,extraKeys:{"Alt-F":"findPersistent","Ctrl-S":t,"Cmd-S":t,Tab:"emmetExpandAbbreviation",Esc:"emmetResetAbbreviation",Enter:"emmetInsertLineBreak","Ctrl-Space":"autocomplete"}};async function c(a){const u=e(a),d=u.attr("name"),v=u.data("tangibleTemplateEditorType"),o={...p,language:v};v==="html"&&(o.emmet={preview:!1});const s=m[d]=await g(a,o);s.setSize(null,"100%"),d==="post_content"&&!b.isNewPost&&s.focus(),a.editor=s,s.save=t,s.codeMirror6}r(c,"y"),k(c,"create");const l=[];h.each(function(){l.push(c(this))}),await Promise.all(l)}r(N,"createEditors"),k(N,"createEditors");var L=Object.defineProperty,_=r((e,t)=>L(e,"name",{value:t,configurable:!0}),"s");function x({$preview:e,$previewButton:t,ajax:h,postId:m,getEditorFields:g,getAdditionalFields:b,setMemory:y}){function p(o,s){o.contentWindow.document,o.contentWindow.document.open(),o.contentWindow.document.write(`<!DOCTYPE html>${s}`),o.contentWindow.document.close()}r(p,"d"),_(p,"setIframeContent");let c=!1,l=!1;function a(){l=!0}r(a,"g"),_(a,"scheduleRenderPreview"),setInterval(function(){l&&(l=!1,c&&u())},3e3);async function u(){const o=e[0],s={id:m,content:"",...g(),...b()};let f=o.getElementsByTagName("iframe")[0];f||(f=document.createElement("iframe"),f.style.width="100%",f.style.height="100%",f.style.minHeight="240px",f.style.border="none",f.style.borderRadius=".5rem",f.style.backgroundColor="#fff",o.style.resize="vertical",o.style.overflowY="auto",o.appendChild(f)),h("tangible_template_editor_render",s).then(function(E){p(f,E.result)}).catch(function(E){p(f,`<p>${E.message}</p>`)})}r(u,"f"),_(u,"renderPreview");let d=!0;t.on("click",function(){const o=!t.hasClass("active");d&&e.toggle(),o?(t.addClass("active"),c=!0,d&&u()):(t.removeClass("active"),c=!1),y({previewOpen:o})});function v(o=!0){d=o,o?c&&!e.is(":visible")&&e.show():c&&e.is(":visible")&&e.hide()}return r(v,"P"),_(v,"setEditorActiveForPreview"),{scheduleRenderPreview:a,setEditorActiveForPreview:v}}r(x,"createPreviewPane"),_(x,"createPreviewPane");var V=Object.defineProperty,P=r((e,t)=>V(e,"name",{value:t,configurable:!0}),"a");window.jQuery(function(e){const t=e("#post"),h=t.find("[data-tangible-template-editor-type]");if(!h.length){console.warn("No editor elements found for Tangible Template code editor");return}const{wp:m}=window;m&&m.autosave&&m.autosave.server&&m.autosave.server.postChanged&&(m.autosave.server.postChanged=function(){return!1});const{Tangible:g}=window,{ajax:b,createCodeEditor:y}=g;g.codeEditors=[];const p={},c=e("#post_ID").val(),l=t.find('input[name="post_title"]'),a=e("#publish"),u=a.closest("#major-publishing-actions"),d=t.find("#tangible-template-editor-meta").data("json")||{},v=["name","assets","location","theme_position","theme_header","theme_footer","universal_id"],o={};for(const i of v){const n=t.find(`[name="${i}"]`);n.length&&(o[i]=n)}const s=["tangible_template_category"],f={};for(const i of s){const n=t.find(`[type="checkbox"][name="tax_input[${i}][]"]`);n.length&&(f[i]=n,n.each(function(){const w=this.getAttribute("checked")==="checked";e(this).prop("checked",w)}))}const E=P(function(i,n=""){a.val(i),n?u.append(`<div id="post-save-error-message" style="padding-top: 8px">${n}</div>`):u.find("#post-save-error-message").remove()},"updatePublishButton"),M=P(function(){const i={};for(let n in p){const w=p[n];n==="post_content"&&(n="content");const $=w.getValue();i[n]=$}return i},"getEditorFields"),B=P(function(){const i={};for(const n of v)o[n]&&(i[n]=o[n].val());return i},"getAdditionalFields"),Y=P(function(){const i={};for(const n of s)f[n]&&(i[n]=[],f[n].each(function(){const w=e(this);w.prop("checked")&&i[n].push(w.val())}));return i},"getTaxonomyFields");function R(){if(d.isNewPost){a.click();return}if(!c)return;const i=l.val();if(!i)return;const n={title:i,id:c,content:"",...M(),...B(),tax_input:Y()},w=a.val();let $;function I(){$&&clearTimeout($),$=setTimeout(function(){a.val(w)},7e3)}r(I,"N"),P(I,"restorePreviousLabelAfterTimeout"),b("tangible_template_editor_save",n).then(function(z){E("Saved"),I()}).catch(function(z){E("Error",z.message),I()})}r(R,"j"),P(R,"save"),!d.isNewPost&&d.postStatus;const H=t.find(".tangible-template-preview-pane"),W=t.find(".tangible-template-tab-selector[data-tab-name=preview]"),{scheduleRenderPreview:K,setEditorActiveForPreview:Q}=x({$preview:H,$previewButton:W,ajax:b,postId:c,getEditorFields:M,getAdditionalFields:B,setMemory:F});N({$:e,save:R,$editors:h,editorInstances:p,createCodeEditor:y,templateMeta:d,Tangible:g}).finally(function(){T.previewOpen&&W.click();for(const[i,n]of Object.entries(p))n&&n.on("change",K);A({$:e,postId:c,$postForm:t,editorInstances:p,setEditorActiveForPreview:Q})})})})();
//# sourceMappingURL=template-editor.min.js.map
