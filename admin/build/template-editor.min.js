var G=Object.defineProperty;var r=(F,j)=>G(F,"name",{value:j,configurable:!0});(function(){"use strict";(function(){const e={NODE_ENV:"production"};try{if(process){process.env=Object.assign({},process.env),Object.assign(process.env,e);return}}catch{}globalThis.process={env:e}})();var F=Object.defineProperty,j=r((e,t)=>F(e,"name",{value:t,configurable:!0}),"t");const x="tangibleTemplateEditorState",P=Object.assign({tab:void 0,postId:0,theme:"default",fontFamily:"default",fontSize:14,previewOpen:!1,previewHeight:220},k()||{});function I(e){window.localStorage&&(Object.assign(P,e),window.localStorage.setItem(x,JSON.stringify(P)))}r(I,"setMemory"),j(I,"setMemory");function k(){if(!window.localStorage)return;let e=window.localStorage.getItem(x);if(e)try{return e=JSON.parse(e),e}catch{}}r(k,"getMemory"),j(k,"getMemory");var D=Object.defineProperty,J=r((e,t)=>D(e,"name",{value:t,configurable:!0}),"g");function N({$:e,postId:t,$postForm:y,editorInstances:g,setEditorActiveForPreview:h}){const b=y.find(".tangible-template-tab-selector"),E=y.find(".tangible-template-tab"),u=[];if(!E.length){console.warn("No tabs elements found for Tangible Template code editor");return}b.on("click",function(){if(e(this).data("tabName")==="preview")return;const l=this;b.each(function(a){const f=e(this),d=f.data("tabName");if(d==="preview")return;const m=E.eq(a);if(this!==l){f.removeClass("active"),m.hide();return}f.addClass("active"),m.show();const n=m.find("[data-tangible-template-editor-type]"),s=n.length?g[n.attr("name")]:!1;u[a]||(u[a]=!0,s&&s.refresh()),s?(s.focus(),h()):h(!1),I({tab:d,postId:t})})});const c=window.location.search.substr(1).split("&").reduce(function(l,a){const[f,d]=a.split("=");return l[f]=d,l},{}).tab||P.postId===t&&P.tab;if(c){const l=b.filter(`[data-tab-name="${c}"]`);l.length&&l.eq(0).click()}}r(N,"handleTabs"),J(N,"handleTabs");var V=Object.defineProperty,M=r((e,t)=>V(e,"name",{value:t,configurable:!0}),"o");async function R({$:e,save:t,$editors:y,editorInstances:g,createCodeEditor:h,templateMeta:b,Tangible:E}){const u={onSave:t,viewportMargin:1/0,resizable:!1,lineWrapping:!0,extraKeys:{"Alt-F":"findPersistent","Ctrl-S":t,"Cmd-S":t,Tab:"emmetExpandAbbreviation",Esc:"emmetResetAbbreviation",Enter:"emmetInsertLineBreak","Ctrl-Space":"autocomplete"}};async function c(a){const f=e(a),d=f.attr("name"),m=f.data("tangibleTemplateEditorType"),n={...u,language:m};m==="html"&&(n.emmet={preview:!1});const s=g[d]=await h(a,n);s.setSize(null,"100%"),d==="post_content"&&!b.isNewPost&&s.focus(),a.editor=s,s.save=t,s.codeMirror6}r(c,"y"),M(c,"create");const l=[];y.each(function(){l.push(c(this))}),await Promise.all(l)}r(R,"createEditors"),M(R,"createEditors");var q=Object.defineProperty,_=r((e,t)=>q(e,"name",{value:t,configurable:!0}),"r");function z({$preview:e,$previewButton:t,ajax:y,postId:g,getEditorFields:h,getAdditionalFields:b,setMemory:E}){function u(n,s){n.contentWindow.document,n.contentWindow.document.open(),n.contentWindow.document.write(`<!DOCTYPE html>${s}`),n.contentWindow.document.close()}r(u,"d"),_(u,"setIframeContent");let c=!1,l=!1;function a(){l=!0}r(a,"w"),_(a,"scheduleRenderPreview"),setInterval(function(){l&&(l=!1,c&&f())},2e3);async function f(){const n=e[0],s={id:g,content:"",...h(),...b()};let p=n.getElementsByTagName("iframe")[0];if(!p&&(p=document.createElement("iframe"),p.style.flex="1",p.style.border="none",p.style.borderRadius=".5rem",p.style.padding=".5rem",p.style.backgroundColor="#fff",n.style.resize="vertical",n.style.overflowY="auto",n.style.display="flex",n.style.minHeight="100px",P.previewHeight&&(n.style.height=`${P.previewHeight}px`),n.appendChild(p),ResizeObserver)){let w;new ResizeObserver(A=>{w&&clearTimeout(w),w=setTimeout(()=>{const $=n.offsetHeight;$&&E({previewHeight:$})},1e3)}).observe(n)}y("tangible_template_editor_render",s).then(function(w){u(p,w.result)}).catch(function(w){u(p,`<p>${w.message}</p>`)})}r(f,"m"),_(f,"renderPreview");let d=!0;t.on("click",function(){const n=!t.hasClass("active");d&&e.toggle(),n?(t.addClass("active"),c=!0,d&&f()):(t.removeClass("active"),c=!1),E({previewOpen:n})});function m(n=!0){d=n,n?c&&!e.is(":visible")&&e.show():c&&e.is(":visible")&&e.hide()}return r(m,"p"),_(m,"setEditorActiveForPreview"),{scheduleRenderPreview:a,setEditorActiveForPreview:m}}r(z,"createPreviewPane"),_(z,"createPreviewPane");var L=Object.defineProperty,O=r((e,t)=>L(e,"name",{value:t,configurable:!0}),"c");window.jQuery(function(e){const t=e("#post"),y=t.find("[data-tangible-template-editor-type]");if(!y.length){console.warn("No editor elements found for Tangible Template code editor");return}const{wp:g}=window;g&&g.autosave&&g.autosave.server&&g.autosave.server.postChanged&&(g.autosave.server.postChanged=function(){return!1});const{Tangible:h}=window,{ajax:b,createCodeEditor:E}=h;h.codeEditors=[];const u={},c=e("#post_ID").val(),l=t.find('input[name="post_title"]'),a=e("#publish"),f=a.closest("#major-publishing-actions"),d=t.find("#tangible-template-editor-meta").data("json")||{},m=["name","assets","location","theme_position","theme_header","theme_footer","universal_id","atomic_css"],n={};for(const i of m){const o=t.find(`[name="${i}"]`);o.length&&(n[i]=o)}const s=["tangible_template_category"],p={};for(const i of s){const o=t.find(`[type="checkbox"][name="tax_input[${i}][]"]`);o.length&&(p[i]=o,o.each(function(){const v=this.getAttribute("checked")==="checked";e(this).prop("checked",v)}))}const w=O(function(i,o=""){a.val(i),o?f.append(`<div id="post-save-error-message" style="padding-top: 8px">${o}</div>`):f.find("#post-save-error-message").remove()},"updatePublishButton"),A=O(function(){const i={};for(let o in u){const v=u[o];o==="post_content"&&(o="content");const T=v.getValue();i[o]=T}return i},"getEditorFields"),$=O(function(){const i={};for(const o of m)n[o]&&(i[o]=n[o].val());return i},"getAdditionalFields"),Y=O(function(){const i={};for(const o of s)p[o]&&(i[o]=[],p[o].each(function(){const v=e(this);v.prop("checked")&&i[o].push(v.val())}));return i},"getTaxonomyFields");function B(){if(d.isNewPost){a.click();return}if(!c)return;const i=l.val();if(!i)return;const o={title:i,id:c,content:"",...A(),...$(),tax_input:Y()},v=a.val();let T;function C(){T&&clearTimeout(T),T=setTimeout(function(){a.val(v)},7e3)}r(C,"a"),O(C,"restorePreviousLabelAfterTimeout"),b("tangible_template_editor_save",o).then(function(W){w("Saved"),C()}).catch(function(W){w("Error",W.message),C()})}r(B,"A"),O(B,"save"),!d.isNewPost&&d.postStatus;const K=t.find(".tangible-template-preview-pane"),S=t.find(".tangible-template-tab-selector[data-tab-name=preview]"),{scheduleRenderPreview:H,setEditorActiveForPreview:Q}=z({$preview:K,$previewButton:S,ajax:b,postId:c,getEditorFields:A,getAdditionalFields:$,setMemory:I});R({$:e,save:B,$editors:y,editorInstances:u,createCodeEditor:E,templateMeta:d,Tangible:h}).finally(function(){const i=window.Tangible.createAtomicCssEngine?window.Tangible.createAtomicCssEngine():null,o=t.find('[name="atomic_css"]'),v=u.post_content;i&&v&&o.length?(v.generateCss=async function(){const T=await i.parse(v.getValue());o.val(JSON.stringify(T))},v.generateCss().then(()=>{P.previewOpen&&S.click()})):P.previewOpen&&S.click();for(const[T,C]of Object.entries(u))C.generateCss?C?.on("change",()=>{C.generateCss().then(H)}):C?.on("change",H);N({$:e,postId:c,$postForm:t,editorInstances:u,setEditorActiveForPreview:Q})})})})();
//# sourceMappingURL=template-editor.min.js.map
