var G=Object.defineProperty;var r=(F,j)=>G(F,"name",{value:j,configurable:!0});(function(){"use strict";(function(){const e={NODE_ENV:"production"};try{if(process){process.env=Object.assign({},process.env),Object.assign(process.env,e);return}}catch{}globalThis.process={env:e}})();var F=Object.defineProperty,j=r((e,t)=>F(e,"name",{value:t,configurable:!0}),"t");const x="tangibleTemplateEditorState",P=Object.assign({tab:void 0,postId:0,theme:"default",fontFamily:"default",fontSize:14,previewOpen:!1,previewHeight:220},k()||{});function I(e){window.localStorage&&(Object.assign(P,e),window.localStorage.setItem(x,JSON.stringify(P)))}r(I,"setMemory"),j(I,"setMemory");function k(){if(!window.localStorage)return;let e=window.localStorage.getItem(x);if(e)try{return e=JSON.parse(e),e}catch{}}r(k,"getMemory"),j(k,"getMemory");var J=Object.defineProperty,V=r((e,t)=>J(e,"name",{value:t,configurable:!0}),"g");function N({$:e,postId:t,$postForm:y,editorInstances:g,setEditorActiveForPreview:h}){const b=y.find(".tangible-template-tab-selector"),E=y.find(".tangible-template-tab"),u=[];if(!E.length){console.warn("No tabs elements found for Tangible Template code editor");return}b.on("click",function(){if(e(this).data("tabName")==="preview")return;const l=this;b.each(function(a){const f=e(this),d=f.data("tabName");if(d==="preview")return;const m=E.eq(a);if(this!==l){f.removeClass("active"),m.hide();return}f.addClass("active"),m.show();const o=m.find("[data-tangible-template-editor-type]"),s=o.length?g[o.attr("name")]:!1;u[a]||(u[a]=!0,s&&s.refresh()),s?(s.focus(),h()):h(!1),I({tab:d,postId:t})})});const c=window.location.search.substr(1).split("&").reduce(function(l,a){const[f,d]=a.split("=");return l[f]=d,l},{}).tab||P.postId===t&&P.tab;if(c){const l=b.filter(`[data-tab-name="${c}"]`);l.length&&l.eq(0).click()}}r(N,"handleTabs"),V(N,"handleTabs");var q=Object.defineProperty,M=r((e,t)=>q(e,"name",{value:t,configurable:!0}),"o");async function R({$:e,save:t,$editors:y,editorInstances:g,createCodeEditor:h,templateMeta:b,Tangible:E}){const u={onSave:t,viewportMargin:1/0,resizable:!1,lineWrapping:!0,extraKeys:{"Alt-F":"findPersistent","Ctrl-S":t,"Cmd-S":t,Tab:"emmetExpandAbbreviation",Esc:"emmetResetAbbreviation",Enter:"emmetInsertLineBreak","Ctrl-Space":"autocomplete"}};async function c(a){const f=e(a),d=f.attr("name"),m=f.data("tangibleTemplateEditorType"),o={...u,language:m};m==="html"&&(o.emmet={preview:!1});const s=g[d]=await h(a,o);s.setSize(null,"100%"),d==="post_content"&&!b.isNewPost&&s.focus(),a.editor=s,s.save=t,s.codeMirror6}r(c,"y"),M(c,"create");const l=[];y.each(function(){l.push(c(this))}),await Promise.all(l)}r(R,"createEditors"),M(R,"createEditors");var L=Object.defineProperty,O=r((e,t)=>L(e,"name",{value:t,configurable:!0}),"n");function z({$preview:e,$previewButton:t,ajax:y,postId:g,getEditorFields:h,getAdditionalFields:b,setMemory:E}){function u(o,s){o.srcdoc=`<!DOCTYPE html>${s}`}r(u,"d"),O(u,"setIframeContent");let c=!1,l=!1;function a(){l=!0}r(a,"p"),O(a,"scheduleRenderPreview"),setInterval(function(){l&&(l=!1,c&&f())},2e3);async function f(){const o=e[0],s={id:g,content:"",...h(),...b()};let p=o.getElementsByTagName("iframe")[0];if(!p&&(p=document.createElement("iframe"),p.style.flex="1",p.style.border="none",p.style.borderRadius=".5rem",p.style.padding=".5rem",p.style.backgroundColor="#fff",o.style.resize="vertical",o.style.overflowY="auto",o.style.display="flex",o.style.minHeight="100px",P.previewHeight&&(o.style.height=`${P.previewHeight}px`),o.appendChild(p),ResizeObserver)){let w;new ResizeObserver(A=>{w&&clearTimeout(w),w=setTimeout(()=>{const $=o.offsetHeight;$&&E({previewHeight:$})},1e3)}).observe(o)}y("tangible_template_editor_render",s).then(function(w){u(p,w.result)}).catch(function(w){u(p,`<p>${w.message}</p>`)})}r(f,"m"),O(f,"renderPreview");let d=!0;t.on("click",function(){const o=!t.hasClass("active");d&&e.toggle(),o?(t.addClass("active"),c=!0,d&&f()):(t.removeClass("active"),c=!1),E({previewOpen:o})});function m(o=!0){d=o,o?c&&!e.is(":visible")&&e.show():c&&e.is(":visible")&&e.hide()}return r(m,"P"),O(m,"setEditorActiveForPreview"),{scheduleRenderPreview:a,setEditorActiveForPreview:m}}r(z,"createPreviewPane"),O(z,"createPreviewPane");var Y=Object.defineProperty,_=r((e,t)=>Y(e,"name",{value:t,configurable:!0}),"c");window.jQuery(function(e){const t=e("#post"),y=t.find("[data-tangible-template-editor-type]");if(!y.length){console.warn("No editor elements found for Tangible Template code editor");return}const{wp:g}=window;g&&g.autosave&&g.autosave.server&&g.autosave.server.postChanged&&(g.autosave.server.postChanged=function(){return!1});const{Tangible:h}=window,{ajax:b,createCodeEditor:E}=h;h.codeEditors=[];const u={},c=e("#post_ID").val(),l=t.find('input[name="post_title"]'),a=e("#publish"),f=a.closest("#major-publishing-actions"),d=t.find("#tangible-template-editor-meta").data("json")||{},m=["name","assets","location","theme_position","theme_header","theme_footer","universal_id","atomic_css"],o={};for(const i of m){const n=t.find(`[name="${i}"]`);n.length&&(o[i]=n)}const s=["tangible_template_category"],p={};for(const i of s){const n=t.find(`[type="checkbox"][name="tax_input[${i}][]"]`);n.length&&(p[i]=n,n.each(function(){const v=this.getAttribute("checked")==="checked";e(this).prop("checked",v)}))}const w=_(function(i,n=""){a.val(i),n?f.append(`<div id="post-save-error-message" style="padding-top: 8px">${n}</div>`):f.find("#post-save-error-message").remove()},"updatePublishButton"),A=_(function(){const i={};for(let n in u){const v=u[n];n==="post_content"&&(n="content");const C=v.getValue();i[n]=C}return i},"getEditorFields"),$=_(function(){const i={};for(const n of m)o[n]&&(i[n]=o[n].val());return i},"getAdditionalFields"),K=_(function(){const i={};for(const n of s)p[n]&&(i[n]=[],p[n].each(function(){const v=e(this);v.prop("checked")&&i[n].push(v.val())}));return i},"getTaxonomyFields");function B(){if(d.isNewPost){a.click();return}if(!c)return;const i=l.val();if(!i)return;const n={title:i,id:c,content:"",...A(),...$(),tax_input:K()},v=a.val();let C;function T(){C&&clearTimeout(C),C=setTimeout(function(){a.val(v)},7e3)}r(T,"a"),_(T,"restorePreviousLabelAfterTimeout"),b("tangible_template_editor_save",n).then(function(D){w("Saved"),T()}).catch(function(D){w("Error",D.message),T()})}r(B,"A"),_(B,"save"),!d.isNewPost&&d.postStatus;const Q=t.find(".tangible-template-preview-pane"),S=t.find(".tangible-template-tab-selector[data-tab-name=preview]"),{scheduleRenderPreview:H,setEditorActiveForPreview:W}=z({$preview:Q,$previewButton:S,ajax:b,postId:c,getEditorFields:A,getAdditionalFields:$,setMemory:I});R({$:e,save:B,$editors:y,editorInstances:u,createCodeEditor:E,templateMeta:d,Tangible:h}).finally(function(){const i=window.Tangible.createAtomicCssEngine?window.Tangible.createAtomicCssEngine():null,n=t.find('[name="atomic_css"]'),v=u.post_content;i&&v&&n.length?(v.generateCss=async function(){const C=await i.parse(v.getValue());n.val(JSON.stringify(C))},v.generateCss().then(()=>{P.previewOpen&&S.click()})):P.previewOpen&&S.click();for(const[C,T]of Object.entries(u))T.generateCss?T?.on("change",()=>{T.generateCss().then(H)}):T?.on("change",H);N({$:e,postId:c,$postForm:t,editorInstances:u,setEditorActiveForPreview:W})})})})();
//# sourceMappingURL=template-editor.min.js.map
