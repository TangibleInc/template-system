var G=Object.defineProperty;var s=(C,_)=>G(C,"name",{value:_,configurable:!0});(function(){"use strict";(function(){const n={NODE_ENV:"production"};try{if(process){process.env=Object.assign({},process.env),Object.assign(process.env,n);return}}catch{}globalThis.process={env:n}})();var C=Object.defineProperty,_=s((n,o)=>C(n,"name",{value:o,configurable:!0}),"e");const x="tangibleTemplateEditorState",E=Object.assign({tab:void 0,postId:0,theme:"default",fontFamily:"default",fontSize:14},M()||{});function F(n){window.localStorage&&(Object.assign(E,n),window.localStorage.setItem(x,JSON.stringify(E)))}s(F,"setMemory"),_(F,"setMemory");function M(){if(!window.localStorage)return;let n=window.localStorage.getItem(x);if(n)try{return n=JSON.parse(n),n}catch{}}s(M,"getMemory"),_(M,"getMemory");var V=Object.defineProperty,H=s((n,o)=>V(n,"name",{value:o,configurable:!0}),"h");function A({$:n,postId:o,$postForm:w,editorInstances:p}){const g=w.find(".tangible-template-tab-selector"),y=w.find(".tangible-template-tab"),T=[];if(!y.length){console.warn("No tabs elements found for Tangible Template code editor");return}g.on("click",function(){if(n(this).data("tabName")==="preview")return;const i=this;g.each(function(u){const r=n(this),f=r.data("tabName");if(f==="preview")return;const c=y.eq(u);if(this!==i){r.removeClass("active"),c.hide();return}r.addClass("active"),c.show();const b=c.find("[data-tangible-template-editor-type]"),l=b.length?p[b.attr("name")]:!1;T[u]||(T[u]=!0,l&&l.refresh()),l&&l.focus(),F({tab:f,postId:o})})});const d=window.location.search.substr(1).split("&").reduce(function(i,u){const[r,f]=u.split("=");return i[r]=f,i},{}).tab||E.postId===o&&E.tab;if(d){const i=g.filter(`[data-tab-name="${d}"]`);i.length&&i.eq(0).click()}}s(A,"handleTabs"),H(A,"handleTabs");var K=Object.defineProperty,W=s((n,o)=>K(n,"name",{value:o,configurable:!0}),"o");async function z({$:n,save:o,$editors:w,editorInstances:p,createCodeEditor:g,templateMeta:y,Tangible:T}){const d={onSave:o,viewportMargin:1/0,resizable:!1,lineWrapping:!0,extraKeys:{"Alt-F":"findPersistent","Ctrl-S":o,"Cmd-S":o,Tab:"emmetExpandAbbreviation",Esc:"emmetResetAbbreviation",Enter:"emmetInsertLineBreak","Ctrl-Space":"autocomplete"}};async function i(r){const f=n(r),c=f.attr("name"),b=f.data("tangibleTemplateEditorType"),l={...d,language:b};b==="html"&&(l.emmet={preview:!1});const h=p[c]=await g(r,l);h.setSize(null,"100%"),c==="post_content"&&!y.isNewPost&&h.focus(),r.editor=h,h.save=o,h.codeMirror6}s(i,"y"),W(i,"create");const u=[];w.each(function(){u.push(i(this))}),await Promise.all(u)}s(z,"createEditors"),W(z,"createEditors");var Q=Object.defineProperty,m=s((n,o)=>Q(n,"name",{value:o,configurable:!0}),"i");window.jQuery(function(n){const o=n("#post"),w=o.find("[data-tangible-template-editor-type]");if(!w.length){console.warn("No editor elements found for Tangible Template code editor");return}const{wp:p}=window;p&&p.autosave&&p.autosave.server&&p.autosave.server.postChanged&&(p.autosave.server.postChanged=function(){return!1});const{Tangible:g}=window,{ajax:y,createCodeEditor:T}=g;g.codeEditors=[];const d={},i=n("#post_ID").val(),u=o.find('input[name="post_title"]'),r=n("#publish"),f=r.closest("#major-publishing-actions"),c=o.find("#tangible-template-editor-meta").data("json")||{},b=["name","assets","location","theme_position","theme_header","theme_footer","universal_id"],l={};for(const t of b){const e=o.find(`[name="${t}"]`);e.length&&(l[t]=e)}const h=["tangible_template_category"],I={};for(const t of h){const e=o.find(`[type="checkbox"][name="tax_input[${t}][]"]`);e.length&&(I[t]=e,e.each(function(){const a=this.getAttribute("checked")==="checked";n(this).prop("checked",a)}))}const B=m(function(t,e=""){r.val(t),e?f.append(`<div id="post-save-error-message" style="padding-top: 8px">${e}</div>`):f.find("#post-save-error-message").remove()},"updatePublishButton"),L=m(function(){const t={};for(let e in d){const a=d[e];e==="post_content"&&(e="content");const v=a.getValue();t[e]=v}return t},"getEditorFields"),R=m(function(){const t={};for(const e of b)l[e]&&(t[e]=l[e].val());return t},"getAdditionalFields"),Y=m(function(){const t={};for(const e of h)I[e]&&(t[e]=[],I[e].each(function(){const a=n(this);a.prop("checked")&&t[e].push(a.val())}));return t},"getTaxonomyFields");function q(){if(c.isNewPost){r.click();return}if(!i)return;const t=u.val();if(!t)return;const e={title:t,id:i,content:"",...L(),...R(),tax_input:Y()},a=r.val();let v;function O(){v&&clearTimeout(v),v=setTimeout(function(){r.val(a)},7e3)}s(O,"F"),m(O,"restorePreviousLabelAfterTimeout"),y("tangible_template_editor_save",e).then(function(J){B("Saved"),O()}).catch(function(J){B("Error",J.message),O()})}s(q,"A"),m(q,"save"),!c.isNewPost&&c.postStatus;const S=o.find(".tangible-template-preview-pane");function j(t,e){t.contentWindow.document,t.contentWindow.document.open(),t.contentWindow.document.write(e),t.contentWindow.document.close()}s(j,"C"),m(j,"setIframeContent");let P=!1,$=!1;function D(){$=!0}s(D,"B"),m(D,"scheduleRenderPreview"),setInterval(function(){$&&($=!1,P&&N())},3e3);async function N(){const t=S[0],e={id:i,content:"",...L(),...R()};let a=t.getElementsByTagName("iframe")[0];a||(a=document.createElement("iframe"),a.style.width="100%",a.style.height="100%",a.style.minHeight="240px",a.style.border="none",a.style.borderRadius=".5rem",a.style.backgroundColor="#fff",t.style.resize="vertical",t.style.overflowY="auto",t.appendChild(a)),y("tangible_template_editor_render",e).then(function(v){j(a,v.result)}).catch(function(v){j(a,`<p>${v.message}</p>`)})}s(N,"E"),m(N,"renderPreview");const k=o.find(".tangible-template-tab-selector[data-tab-name=preview]");k.on("click",function(){S.toggle(),S.is(":visible")?(k.addClass("active"),P=!0,N()):(k.removeClass("active"),P=!1)}),z({$:n,save:q,$editors:w,editorInstances:d,createCodeEditor:T,templateMeta:c,Tangible:g}).finally(function(){for(const[t,e]of Object.entries(d))e&&e.on("change",D);A({$:n,postId:i,$postForm:o,editorInstances:d})})})})();
//# sourceMappingURL=template-editor.min.js.map
