var X=Object.defineProperty;var a=(O,I)=>X(O,"name",{value:I,configurable:!0});(function(){"use strict";(function(){const n={NODE_ENV:"production"};try{if(process){process.env=Object.assign({},process.env),Object.assign(process.env,n);return}}catch{}globalThis.process={env:n}})();var O=Object.defineProperty,I=a((n,o)=>O(n,"name",{value:o,configurable:!0}),"t");const A="tangibleTemplateEditorState",T=Object.assign({tab:void 0,postId:0,theme:"default",fontFamily:"default",fontSize:14,previewOpen:!1},M()||{});function S(n){window.localStorage&&(Object.assign(T,n),window.localStorage.setItem(A,JSON.stringify(T)))}a(S,"setMemory"),I(S,"setMemory");function M(){if(!window.localStorage)return;let n=window.localStorage.getItem(A);if(n)try{return n=JSON.parse(n),n}catch{}}a(M,"getMemory"),I(M,"getMemory");var K=Object.defineProperty,Q=a((n,o)=>K(n,"name",{value:o,configurable:!0}),"g");function W({$:n,postId:o,$postForm:y,editorInstances:m,setEditorActiveForPreview:h}){const w=y.find(".tangible-template-tab-selector"),_=y.find(".tangible-template-tab"),f=[];if(!_.length){console.warn("No tabs elements found for Tangible Template code editor");return}w.on("click",function(){if(n(this).data("tabName")==="preview")return;const c=this;w.each(function(r){const d=n(this),l=d.data("tabName");if(l==="preview")return;const v=_.eq(r);if(this!==c){d.removeClass("active"),v.hide();return}d.addClass("active"),v.show();const g=v.find("[data-tangible-template-editor-type]"),s=g.length?m[g.attr("name")]:!1;f[r]||(f[r]=!0,s&&s.refresh()),s?(s.focus(),h()):h(!1),S({tab:l,postId:o})})});const p=window.location.search.substr(1).split("&").reduce(function(c,r){const[d,l]=r.split("=");return c[d]=l,c},{}).tab||T.postId===o&&T.tab;if(p){const c=w.filter(`[data-tab-name="${p}"]`);c.length&&c.eq(0).click()}}a(W,"handleTabs"),Q(W,"handleTabs");var Y=Object.defineProperty,z=a((n,o)=>Y(n,"name",{value:o,configurable:!0}),"o$1");async function B({$:n,save:o,$editors:y,editorInstances:m,createCodeEditor:h,templateMeta:w,Tangible:_}){const f={onSave:o,viewportMargin:1/0,resizable:!1,lineWrapping:!0,extraKeys:{"Alt-F":"findPersistent","Ctrl-S":o,"Cmd-S":o,Tab:"emmetExpandAbbreviation",Esc:"emmetResetAbbreviation",Enter:"emmetInsertLineBreak","Ctrl-Space":"autocomplete"}};async function p(r){const d=n(r),l=d.attr("name"),v=d.data("tangibleTemplateEditorType"),g={...f,language:v};v==="html"&&(g.emmet={preview:!1});const s=m[l]=await h(r,g);s.setSize(null,"100%"),l==="post_content"&&!w.isNewPost&&s.focus(),r.editor=s,s.save=o,s.codeMirror6}a(p,"y"),z(p,"create");const c=[];y.each(function(){c.push(p(this))}),await Promise.all(c)}a(B,"createEditors"),z(B,"createEditors");var G=Object.defineProperty,u=a((n,o)=>G(n,"name",{value:o,configurable:!0}),"o");window.jQuery(function(n){const o=n("#post"),y=o.find("[data-tangible-template-editor-type]");if(!y.length){console.warn("No editor elements found for Tangible Template code editor");return}const{wp:m}=window;m&&m.autosave&&m.autosave.server&&m.autosave.server.postChanged&&(m.autosave.server.postChanged=function(){return!1});const{Tangible:h}=window,{ajax:w,createCodeEditor:_}=h;h.codeEditors=[];const f={},p=n("#post_ID").val(),c=o.find('input[name="post_title"]'),r=n("#publish"),d=r.closest("#major-publishing-actions"),l=o.find("#tangible-template-editor-meta").data("json")||{},v=["name","assets","location","theme_position","theme_header","theme_footer","universal_id"],g={};for(const e of v){const t=o.find(`[name="${e}"]`);t.length&&(g[e]=t)}const s=["tangible_template_category"],$={};for(const e of s){const t=o.find(`[type="checkbox"][name="tax_input[${e}][]"]`);t.length&&($[e]=t,t.each(function(){const i=this.getAttribute("checked")==="checked";n(this).prop("checked",i)}))}const R=u(function(e,t=""){r.val(e),t?d.append(`<div id="post-save-error-message" style="padding-top: 8px">${t}</div>`):d.find("#post-save-error-message").remove()},"updatePublishButton"),L=u(function(){const e={};for(let t in f){const i=f[t];t==="post_content"&&(t="content");const b=i.getValue();e[t]=b}return e},"getEditorFields"),q=u(function(){const e={};for(const t of v)g[t]&&(e[t]=g[t].val());return e},"getAdditionalFields"),U=u(function(){const e={};for(const t of s)$[t]&&(e[t]=[],$[t].each(function(){const i=n(this);i.prop("checked")&&e[t].push(i.val())}));return e},"getTaxonomyFields");function D(){if(l.isNewPost){r.click();return}if(!p)return;const e=c.val();if(!e)return;const t={title:e,id:p,content:"",...L(),...q(),tax_input:U()},i=r.val();let b;function x(){b&&clearTimeout(b),b=setTimeout(function(){r.val(i)},7e3)}a(x,"C"),u(x,"restorePreviousLabelAfterTimeout"),w("tangible_template_editor_save",t).then(function(H){R("Saved"),x()}).catch(function(H){R("Error",H.message),x()})}a(D,"B"),u(D,"save"),!l.isNewPost&&l.postStatus;const E=o.find(".tangible-template-preview-pane");function j(e,t){e.contentWindow.document,e.contentWindow.document.open(),e.contentWindow.document.write(t),e.contentWindow.document.close()}a(j,"P"),u(j,"setIframeContent");let C=!1,k=!1;function J(){k=!0}a(J,"O"),u(J,"scheduleRenderPreview"),setInterval(function(){k&&(k=!1,C&&N())},3e3);async function N(){const e=E[0],t={id:p,content:"",...L(),...q()};let i=e.getElementsByTagName("iframe")[0];i||(i=document.createElement("iframe"),i.style.width="100%",i.style.height="100%",i.style.minHeight="240px",i.style.border="none",i.style.borderRadius=".5rem",i.style.backgroundColor="#fff",e.style.resize="vertical",e.style.overflowY="auto",e.appendChild(i)),w("tangible_template_editor_render",t).then(function(b){j(i,b.result)}).catch(function(b){j(i,`<p>${b.message}</p>`)})}a(N,"$"),u(N,"renderPreview");const P=o.find(".tangible-template-tab-selector[data-tab-name=preview]");let F=!0;P.on("click",function(){const e=!P.hasClass("active");F&&E.toggle(),e?(P.addClass("active"),C=!0,F&&N()):(P.removeClass("active"),C=!1),S({previewOpen:e})});function V(e=!0){F=e,e?C&&!E.is(":visible")&&E.show():C&&E.is(":visible")&&E.hide()}a(V,"L"),u(V,"setEditorActiveForPreview"),B({$:n,save:D,$editors:y,editorInstances:f,createCodeEditor:_,templateMeta:l,Tangible:h}).finally(function(){T.previewOpen&&P.click();for(const[e,t]of Object.entries(f))t&&t.on("change",J);W({$:n,postId:p,$postForm:o,editorInstances:f,setEditorActiveForPreview:V})})})})();
//# sourceMappingURL=template-editor.min.js.map
