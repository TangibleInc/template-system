var V=Object.defineProperty;var r=(E,T)=>V(E,"name",{value:T,configurable:!0});(function(){"use strict";(function(){const e={NODE_ENV:"production"};try{if(process){process.env=Object.assign({},process.env),Object.assign(process.env,e);return}}catch{}globalThis.process={env:e}})();var E=Object.defineProperty,T=r((e,n)=>E(e,"name",{value:n,configurable:!0}),"e");const j="tangibleTemplateEditorState",_=Object.assign({tab:void 0,postId:0,theme:"default",fontFamily:"default",fontSize:14},N()||{});function I(e){window.localStorage&&(Object.assign(_,e),window.localStorage.setItem(j,JSON.stringify(_)))}r(I,"setMemory"),T(I,"setMemory");function N(){if(!window.localStorage)return;let e=window.localStorage.getItem(j);if(e)try{return e=JSON.parse(e),e}catch{}}r(N,"getMemory"),T(N,"getMemory");var M=Object.defineProperty,A=r((e,n)=>M(e,"name",{value:n,configurable:!0}),"u");function O({$:e,postId:n,$postForm:g,editorInstances:l}){const d=g.find(".tangible-template-tab-selector"),b=g.find(".tangible-template-tab"),h=[];if(!b.length){console.warn("No tabs elements found for Tangible Template code editor");return}d.on("click",function(){const a=this;d.each(function(c){const i=e(this),f=i.data("tabName"),s=b.eq(c);if(this!==a){i.removeClass("active"),s.hide();return}i.addClass("active"),s.show();const w=s.find("[data-tangible-template-editor-type]"),p=w.length?l[w.attr("name")]:!1;h[c]||(h[c]=!0,p&&p.refresh()),p&&p.focus(),I({tab:f,postId:n})})});const u=window.location.search.substr(1).split("&").reduce(function(a,c){const[i,f]=c.split("=");return a[i]=f,a},{}).tab||_.postId===n&&_.tab;if(u){const a=d.filter(`[data-tab-name="${u}"]`);a.length&&a.eq(0).click()}}r(O,"handleTabs"),A(O,"handleTabs");var z=Object.defineProperty,q=r((e,n)=>z(e,"name",{value:n,configurable:!0}),"s$1");async function k({$:e,save:n,$editors:g,editorInstances:l,createCodeEditor:d,templateMeta:b,Tangible:h}){const u={onSave:n,viewportMargin:1/0,resizable:!1,lineWrapping:!0,extraKeys:{"Alt-F":"findPersistent","Ctrl-S":n,"Cmd-S":n,Tab:"emmetExpandAbbreviation",Esc:"emmetResetAbbreviation",Enter:"emmetInsertLineBreak","Ctrl-Space":"autocomplete"}};g.each(async function(){const a=e(this),c=a.attr("name"),i=a.data("tangibleTemplateEditorType"),f={...u,language:i};i==="html"&&(f.emmet={preview:!1});const s=l[c]=await d(this,f);s.setSize(null,"100%"),c==="post_content"&&!b.isNewPost&&s.focus(),this.editor=s,s.save=n,s.codeMirror6})}r(k,"createEditors"),q(k,"createEditors");var B=Object.defineProperty,v=r((e,n)=>B(e,"name",{value:n,configurable:!0}),"s");window.jQuery(function(e){const n=e("#post"),g=n.find("[data-tangible-template-editor-type]");if(!g.length){console.warn("No editor elements found for Tangible Template code editor");return}const{wp:l}=window;l&&l.autosave&&l.autosave.server&&l.autosave.server.postChanged&&(l.autosave.server.postChanged=function(){return!1});const{Tangible:d}=window,{ajax:b,createCodeEditor:h}=d;d.codeEditors=[];const u={},a=e("#post_ID").val(),c=n.find('input[name="post_title"]'),i=e("#publish"),f=i.closest("#major-publishing-actions"),s=n.find("#tangible-template-editor-meta").data("json")||{},w=["name","assets","location","theme_position","theme_header","theme_footer","universal_id"],p={};for(const o of w){const t=n.find(`[name="${o}"]`);t.length&&(p[o]=t)}const C=["tangible_template_category"],S={};for(const o of C){const t=n.find(`[type="checkbox"][name="tax_input[${o}][]"]`);t.length&&(S[o]=t,t.each(function(){const m=this.getAttribute("checked")==="checked";e(this).prop("checked",m)}))}const P=v(function(o,t=""){i.val(o),t?f.append(`<div id="post-save-error-message" style="padding-top: 8px">${t}</div>`):f.find("#post-save-error-message").remove()},"updatePublishButton"),D=v(function(){const o={};for(let t in u){const m=u[t];t==="post_content"&&(t="content");const y=m.getValue();o[t]=y}return o},"getEditorFields"),J=v(function(){const o={};for(const t of w)p[t]&&(o[t]=p[t].val());return o},"getAdditionalFields"),L=v(function(){const o={};for(const t of C)S[t]&&(o[t]=[],S[t].each(function(){const m=e(this);m.prop("checked")&&o[t].push(m.val())}));return o},"getTaxonomyFields");function x(){if(s.isNewPost){i.click();return}if(!a)return;const o=c.val();if(!o)return;const t={title:o,id:a,content:"",...D(),...J(),tax_input:L()},m=i.val();let y;function $(){y&&clearTimeout(y),y=setTimeout(function(){i.val(m)},7e3)}r($,"w"),v($,"restorePreviousLabelAfterTimeout"),b("tangible_template_editor_save",t).then(function(F){P("Saved"),$()}).catch(function(F){P("Error",F.message),$()})}r(x,"j"),v(x,"save"),!s.isNewPost&&s.postStatus,k({$:e,save:x,$editors:g,editorInstances:u,createCodeEditor:h,templateMeta:s,Tangible:d}),O({$:e,postId:a,$postForm:n,editorInstances:u})})})();
//# sourceMappingURL=template-editor.min.js.map
