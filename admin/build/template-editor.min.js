var G=Object.defineProperty;var s=(j,I)=>G(j,"name",{value:I,configurable:!0});(function(){"use strict";(function(){const e={NODE_ENV:"production"};try{if(process){process.env=Object.assign({},process.env),Object.assign(process.env,e);return}}catch{}globalThis.process={env:e}})();var j=Object.defineProperty,I=s((e,t)=>j(e,"name",{value:t,configurable:!0}),"t");const x="tangibleTemplateEditorState",P=Object.assign({tab:void 0,postId:0,theme:"default",fontFamily:"default",fontSize:14,previewOpen:!1,previewHeight:220},k()||{});function F(e){window.localStorage&&(Object.assign(P,e),window.localStorage.setItem(x,JSON.stringify(P)))}s(F,"setMemory"),I(F,"setMemory");function k(){if(!window.localStorage)return;let e=window.localStorage.getItem(x);if(e)try{return e=JSON.parse(e),e}catch{}}s(k,"getMemory"),I(k,"getMemory");var J=Object.defineProperty,V=s((e,t)=>J(e,"name",{value:t,configurable:!0}),"g$1");function N({$:e,postId:t,$postForm:y,editorInstances:g,setEditorActiveForPreview:b}){const h=y.find(".tangible-template-tab-selector"),T=y.find(".tangible-template-tab"),u=[];if(!T.length){console.warn("No tabs elements found for Tangible Template code editor");return}h.on("click",function(){if(e(this).data("tabName")==="preview")return;const d=this;h.each(function(a){const f=e(this),r=f.data("tabName");if(r==="preview")return;const m=T.eq(a);if(this!==d){f.removeClass("active"),m.hide();return}f.addClass("active"),m.show();const n=m.find("[data-tangible-template-editor-type]"),c=n.length?g[n.attr("name")]:!1;u[a]||(u[a]=!0,c&&c.refresh()),c?(c.focus(),b()):b(!1),F({tab:r,postId:t})})});const l=window.location.search.substr(1).split("&").reduce(function(d,a){const[f,r]=a.split("=");return d[f]=r,d},{}).tab||P.postId===t&&P.tab;if(l){const d=h.filter(`[data-tab-name="${l}"]`);d.length&&d.eq(0).click()}}s(N,"handleTabs"),V(N,"handleTabs");var q=Object.defineProperty,M=s((e,t)=>q(e,"name",{value:t,configurable:!0}),"a");async function R({$:e,save:t,$editors:y,editorInstances:g,createCodeEditor:b,templateMeta:h,Tangible:T}){const u={onSave:t,viewportMargin:1/0,resizable:!1,lineWrapping:!0,extraKeys:{"Alt-F":"findPersistent","Ctrl-S":t,"Cmd-S":t,Tab:"emmetExpandAbbreviation",Esc:"emmetResetAbbreviation",Enter:"emmetInsertLineBreak","Ctrl-Space":"autocomplete"}};async function l(a){const f=e(a),r=f.attr("name"),m=f.data("tangibleTemplateEditorType"),n={...u,language:m};m==="html"&&(n.emmet={preview:!1}),r==="controls_template"&&(n.htmlTags=!1,n.controlTags=!0);const c=g[r]=await b(a,n);c.setSize(null,"100%"),r==="post_content"&&!h.isNewPost&&c.focus(),a.editor=c,c.save=t,c.codeMirror6}s(l,"y"),M(l,"create");const d=[];y.each(function(){d.push(l(this))}),await Promise.all(d)}s(R,"createEditors"),M(R,"createEditors");var L=Object.defineProperty,O=s((e,t)=>L(e,"name",{value:t,configurable:!0}),"n");function z({$preview:e,$previewButton:t,ajax:y,postId:g,getEditorFields:b,getAdditionalFields:h,setMemory:T}){function u(n,c){n.srcdoc=`<!DOCTYPE html>${c}`}s(u,"d"),O(u,"setIframeContent");let l=!1,d=!1;function a(){d=!0}s(a,"p"),O(a,"scheduleRenderPreview"),setInterval(function(){d&&(d=!1,l&&f())},2e3);async function f(){const n=e[0],c={id:g,content:"",...b(),...h()};let p=n.getElementsByTagName("iframe")[0];if(!p&&(p=document.createElement("iframe"),p.style.flex="1",p.style.border="none",p.style.borderRadius=".5rem",p.style.padding=".5rem",p.style.backgroundColor="#fff",n.style.resize="vertical",n.style.overflowY="auto",n.style.display="flex",n.style.minHeight="100px",P.previewHeight&&(n.style.height=`${P.previewHeight}px`),n.appendChild(p),ResizeObserver)){let w;new ResizeObserver(A=>{w&&clearTimeout(w),w=setTimeout(()=>{const $=n.offsetHeight;$&&T({previewHeight:$})},1e3)}).observe(n)}y("tangible_template_editor_render",c).then(function(w){u(p,w.result)}).catch(function(w){u(p,`<p>${w.message}</p>`)})}s(f,"m"),O(f,"renderPreview");let r=!0;t.on("click",function(){const n=!t.hasClass("active");r&&e.toggle(),n?(t.addClass("active"),l=!0,r&&f()):(t.removeClass("active"),l=!1),T({previewOpen:n})});function m(n=!0){r=n,n?l&&!e.is(":visible")&&e.show():l&&e.is(":visible")&&e.hide()}return s(m,"P"),O(m,"setEditorActiveForPreview"),{scheduleRenderPreview:a,setEditorActiveForPreview:m}}s(z,"createPreviewPane"),O(z,"createPreviewPane");var Y=Object.defineProperty,_=s((e,t)=>Y(e,"name",{value:t,configurable:!0}),"c");window.jQuery(function(e){const t=e("#post"),y=t.find("[data-tangible-template-editor-type]");if(!y.length){console.warn("No editor elements found for Tangible Template code editor");return}const{wp:g}=window;g&&g.autosave&&g.autosave.server&&g.autosave.server.postChanged&&(g.autosave.server.postChanged=function(){return!1});const{Tangible:b}=window,{ajax:h,createCodeEditor:T}=b;b.codeEditors=[];const u={},l=e("#post_ID").val(),d=t.find('input[name="post_title"]'),a=e("#publish"),f=a.closest("#major-publishing-actions"),r=t.find("#tangible-template-editor-meta").data("json")||{},m=["name","assets","location","theme_position","theme_header","theme_footer","universal_id","atomic_css"],n={};for(const i of m){const o=t.find(`[name="${i}"]`);o.length&&(n[i]=o)}const c=["tangible_template_category"],p={};for(const i of c){const o=t.find(`[type="checkbox"][name="tax_input[${i}][]"]`);o.length&&(p[i]=o,o.each(function(){const v=this.getAttribute("checked")==="checked";e(this).prop("checked",v)}))}const w=_(function(i,o=""){a.val(i),o?f.append(`<div id="post-save-error-message" style="padding-top: 8px">${o}</div>`):f.find("#post-save-error-message").remove()},"updatePublishButton"),A=_(function(){const i={};for(let o in u){const v=u[o];o==="post_content"&&(o="content");const E=v.getValue();i[o]=E}return i},"getEditorFields"),$=_(function(){const i={};for(const o of m)n[o]&&(i[o]=n[o].val());return i},"getAdditionalFields"),K=_(function(){const i={};for(const o of c)p[o]&&(i[o]=[],p[o].each(function(){const v=e(this);v.prop("checked")&&i[o].push(v.val())}));return i},"getTaxonomyFields");function H(){if(r.isNewPost){a.click();return}if(!l)return;const i=d.val();if(!i)return;const o={title:i,id:l,content:"",...A(),...$(),tax_input:K()},v=a.val();let E;function C(){E&&clearTimeout(E),E=setTimeout(function(){a.val(v)},7e3)}s(C,"a"),_(C,"restorePreviousLabelAfterTimeout"),h("tangible_template_editor_save",o).then(function(D){w("Saved"),C()}).catch(function(D){w("Error",D.message),C()})}s(H,"j"),_(H,"save"),!r.isNewPost&&r.postStatus;const Q=t.find(".tangible-template-preview-pane"),S=t.find(".tangible-template-tab-selector[data-tab-name=preview]"),{scheduleRenderPreview:B,setEditorActiveForPreview:W}=z({$preview:Q,$previewButton:S,ajax:h,postId:l,getEditorFields:A,getAdditionalFields:$,setMemory:F});R({$:e,save:H,$editors:y,editorInstances:u,createCodeEditor:T,templateMeta:r,Tangible:b}).finally(function(){const i=window.Tangible.createAtomicCssEngine?window.Tangible.createAtomicCssEngine():null,o=t.find('[name="atomic_css"]'),v=u.post_content;i&&v&&o.length?(v.generateCss=async function(){const E=await i.parse(v.getValue());o.val(JSON.stringify({variables:E.variables,selectors:E.selectors}))},v.generateCss().then(()=>{P.previewOpen&&S.click()})):P.previewOpen&&S.click();for(const[E,C]of Object.entries(u))C.generateCss?C?.on("change",()=>{C.generateCss().then(B)}):C?.on("change",B);N({$:e,postId:l,$postForm:t,editorInstances:u,setEditorActiveForPreview:W})})})})();
