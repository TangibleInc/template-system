var K=Object.defineProperty;var u=(f,b)=>K(f,"name",{value:b,configurable:!0});(function(){"use strict";(function(){const o={env:{NODE_ENV:"production"}};try{if(process){process.env=Object.assign({},process.env),Object.assign(process.env,o);return}}catch(n){}globalThis.process={env:o}})();var f=Object.defineProperty,b=Object.defineProperties,C=Object.getOwnPropertyDescriptors,T=Object.getOwnPropertySymbols,F=Object.prototype.hasOwnProperty,D=Object.prototype.propertyIsEnumerable,j=u((o,n,s)=>n in o?f(o,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):o[n]=s,"E"),h=u((o,n)=>{for(var s in n||(n={}))F.call(n,s)&&j(o,s,n[s]);if(T)for(var s of T(n))D.call(n,s)&&j(o,s,n[s]);return o},"p"),O=u((o,n)=>b(o,C(n)),"T"),p=u((o,n)=>f(o,"name",{value:n,configurable:!0}),"d");jQuery(function(o){const n=o("#post"),s=n.find("[data-tangible-template-editor-type]");s.length||console.warn("No editor elements found for Tangible Template code editor");const d={},P=o("#post_ID").val(),L=n.find('input[name="post_title"]'),c=o("#publish"),k=c.closest("#major-publishing-actions"),m=n.find("#tangible-template-editor-meta").data("json")||{},{ajax:$,createCodeEditor:I}=window.Tangible,E=["name","assets","location","theme_position","theme_header","theme_footer","universal_id"],v={};for(const t of E){const e=n.find(`[name="${t}"]`);e.length&&(v[t]=e)}const x=["tangible_template_category"],g={};for(const t of x){const e=n.find(`[type="checkbox"][name="tax_input[${t}][]"]`);e.length&&(g[t]=e,e.each(function(){const i=this.getAttribute("checked")==="checked";o(this).prop("checked",i)}))}const S=p(function(t,e){c.val(t),e?k.append(`<div id="post-save-error-message" style="padding-top: 8px">${e}</div>`):k.find("#post-save-error-message").remove()},"updatePublishButton"),q=p(function(){const t={};for(let e in d){const i=d[e];e==="post_content"&&(e="content");const a=i.getValue();t[e]=a}return t},"getEditorFields"),z=p(function(){const t={};for(const e of E)!v[e]||(t[e]=v[e].val());return t},"getAdditionalFields"),B=p(function(){const t={};for(const e of x)!g[e]||(t[e]=[],g[e].each(function(){const i=o(this);i.prop("checked")&&t[e].push(i.val())}));return t},"getTaxonomyFields"),y=p(function(){if(m.isNewPost){c.click();return}if(!P)return;const t=L.val();if(!t)return;const e=O(h(h({title:t,id:P,content:""},q()),z()),{tax_input:B()}),i=c.val();let a;function r(){a&&clearTimeout(a),a=setTimeout(function(){c.val(i)},4e3)}u(r,"c"),p(r,"restorePreviousLabelAfterTimeout"),c.val("Saving.."),$("tangible_template_editor_save",e).then(function(l){S("Saved"),r()}).catch(function(l){S("Error",l.message),r()})},"save");!m.isNewPost&&m.postStatus==="publish"&&c.on("click",function(t){t.preventDefault(),y()});const V={viewportMargin:1/0,resizable:!1,lineWrapping:!0,extraKeys:{"Alt-F":"findPersistent","Ctrl-S":y,"Cmd-S":y,Tab:"emmetExpandAbbreviation",Esc:"emmetResetAbbreviation",Enter:"emmetInsertLineBreak","Ctrl-Space":"autocomplete"}};s.each(function(){const t=o(this),e=t.attr("name"),i=t.data("tangibleTemplateEditorType"),a=O(h({},V),{language:i});i==="html"&&(a.emmet={preview:!1,config:{html:{Loop:"Loop[type]",Field:"Field/"}}});const r=d[e]=I(this,a);r.setSize(null,"100%"),e==="post_content"&&!m.isNewPost&&r.focus()});const w=n.find(".tangible-template-tab-selector"),N=n.find(".tangible-template-tab"),A=[];if(!N.length){console.warn("No tabs elements found for Tangible Template code editor");return}w.on("click",function(){const t=this;w.each(function(e){const i=o(this),a=N.eq(e);if(this!==t){i.removeClass("active"),a.hide();return}i.addClass("active"),a.show();const r=a.find("[data-tangible-template-editor-type]"),l=r.length?d[r.attr("name")]:!1;A[e]||(A[e]=!0,l&&l.refresh()),l&&l.focus()})});const _=window.location.search.substr(1).split("&").reduce(function(t,e){const[i,a]=e.split("=");return t[i]=a,t},{});if(_.tab){const t=w.filter(`[data-tab-name="${_.tab}"]`);t.length?t.eq(0).click():console.warn("Tab not found",_.tab)}})})();
//# sourceMappingURL=template-editor.min.js.map
