{"version":3,"file":"module-loader.min.js","sources":["../src/assetLoader.ts","../src/index.ts"],"sourcesContent":["/**\n * Asset loader: JS and CSS with dependencies\n */\nconst loading = {} // name => Promise\nconst loaded = {} // name => true\n\nasync function assetLoader(assets) {\n  if (!assets || !assets.length) return\n  if (Array.isArray(assets)) {\n    return await Promise.all(assets.map(assetLoader))\n  }\n  if (typeof assets === 'string') {\n    assets = { file: assets }\n  }\n\n  const { file = '', depend = [] } = assets\n\n  // Ensure dependencies\n  if (depend.length) await assetLoader(depend)\n\n  // Loaded\n  if (loaded[file]) return\n\n  // Currently loading\n  if (loading[file]) return await loading[file]\n\n  // Start loading\n  loading[file] = new Promise((resolve, reject) => {\n    // Create DOM element and await loaded\n\n    const extension = file.split('.').pop()\n\n    const handler = function (e) {\n      delete loading[file] // Clear loading state\n\n      // e.type is 'load' or 'error'\n      if (e.type[0] === 'e')\n        return reject(new Error(`Failed loading file: ${file}`))\n\n      loaded[file] = true\n      resolve()\n    }\n\n    if (extension === 'css') {\n      const el = window.document.createElement('link')\n\n      el.onload = el.onerror = handler\n      el.rel = 'stylesheet'\n      el.href = file\n\n      window.document.head.appendChild(el)\n\n      return\n    }\n\n    if (extension === 'js') {\n      const el = window.document.createElement('script')\n\n      el.onload = el.onerror = handler\n      el.src = file\n\n      window.document.head.appendChild(el)\n\n      return\n    }\n\n    reject(new Error(`Unknown file extension: ${file}`))\n  })\n\n  return await loading[file]\n}\n\nexport default assetLoader\n","import assetLoader from './assetLoader'\n\nconst $ = window.jQuery\nconst Tangible = (window.Tangible = window.Tangible || {})\nconst modules = (Tangible.modules = Tangible.modules || {})\n\nfunction moduleLoader(element) {\n\n  let moduleIndex = 0\n  const $el = $(element)\n  const $modules = $el.hasClass('tangible-dynamic-module')\n    ? $el\n    : $el.find('.tangible-dynamic-module')\n\n  $modules.each(function () {\n    const el = this\n    const $el = $(el)\n    const moduleName = $el.data('tangibleDynamicModule')\n    const options = $el.data('tangibleDynamicModuleOptions') || {}\n\n    if (!modules[moduleName]) {\n      console.warn('Unknown dynamic module', moduleName)\n      console.log(modules)\n      return\n    }\n\n    const { assets = [], callback } = modules[moduleName]\n\n    moduleIndex++\n\n    assetLoader(assets)\n      .then(function () {\n        if (callback) {\n          callback(el, options)\n          return\n        }\n\n        switch (moduleName) {\n          case 'chart':\n            $.fn.tangibleChart && $el.tangibleChart()\n            break\n          case 'embed-dynamic': // TODO:\n            break\n          case 'glider':\n            $.fn.tangibleGlider && $el.tangibleGlider()\n            break\n          case 'mermaid':\n            Tangible.mermaid && Tangible.mermaid.activateElement(el, options)\n            break\n          case 'paginator': // TODO:\n            break\n          case 'prism':\n            Prism && Prism.highlightAllUnder && Prism.highlightAllUnder(el)\n            break\n          case 'slider':\n            $.fn.tangibleSlider && $el.tangibleSlider()\n            break\n          case 'table': // TODO:\n            break\n          default:\n            console.warn('No initializer for module', moduleName)\n            break\n        }\n      })\n      .catch(function (e) {\n        console.error('Tangible.moduleLoader', e)\n      })\n  })\n}\n\nfunction registerModule(name, config) {\n  if (!modules[name]) {\n    modules[name] = {\n      assets: [],\n      // callback\n    }\n  }\n  Object.assign(modules[name], config)\n}\n\nObject.assign(Tangible, {\n  assetLoader,\n  moduleLoader,\n  registerModule,\n})\n\n/*\n$(document).ready(function() {\n  moduleLoader(document.body)\n})\n*/\n"],"names":["loading","loaded","assetLoader","assets","file","depend","resolve","reject","extension","handler","__name","e","el","$","Tangible","modules","moduleLoader","element","$el","moduleName","options","callback","registerModule","name","config"],"mappings":"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"}