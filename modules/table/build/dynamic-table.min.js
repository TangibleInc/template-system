var ge=Object.defineProperty;var f=(C,o)=>ge(C,"name",{value:o,configurable:!0});(function(){"use strict";(function(){const l={NODE_ENV:"production"};try{if(process){process.env=Object.assign({},process.env),Object.assign(process.env,l);return}}catch{}globalThis.process={env:l}})();var C=Object.defineProperty,o=f((l,d)=>C(l,"name",{value:d,configurable:!0}),"o");const h=window.jQuery,{Table:E,ajax:M}=window.Tangible||{},W=!1,X=o(l=>["log","warn","error"].reduce((d,s)=>(d[s]=(...p)=>s==="log"&&!W?null:window.console[s](`[${l}]`,...p),d),{}),"createLogger"),a=X("Tangible Table"),Y=o((l,d)=>{let s;return function(){clearTimeout(s),s=window.setTimeout(()=>l.apply(this,arguments),d)}},"debounce"),F="__tangibleTableRendered";function P(l,d={}){if(!E){a.warn("Library not found");return}const s=typeof l=="string"?document.querySelector(l):l;if(!s){a.warn("Element not found",l);return}if(s[F])return;s[F]=!0;const p=h(s),S=p.data("tangibleTableConfig")||{};a.log("Config",S);const{name:fe,rows:K=[],column_label:Z={},column_sort_enabled:ee=[],column_sort_type:N={},pagination:te=!0,pagination_template:ne,empty_table_template:oe="",row_loop:L,column_template:ae,column_order:le}=S;let u=1,{per_page:j=-1,total_pages:_,sort_column:D,sort_order:O,sort_type:R}=S,x="",U=[],$={},g=h("<div><div></div></div>");const re=g.find("div")[0],V={...d,element:re,data:K,columns:Z,sorting:ee,rowsPerPage:j===-1?999:j,pagination:te,totalPages:_,paginationTemplate:ne,onPaginationChange:I,onColumnSort:Q},m=new E(V);a.log("Created",V),p.empty().append(g.find("table").children());const k=g.find(".tangible-table-pagination");k.insertAfter(p),p.wrap('<div class="tangible-table-overflow"></div>');const y=h('<div class="tangible-table-on-empty">'+oe+"</div>");y.hide(),y.insertAfter(k),g=p.closest(".tangible-table-container");const G=p,T={},ie=o(t=>{const e=Object.keys(t);return e.sort(),e.reduce((n,r)=>`${n}${r}=${JSON.stringify(t[r])},`,"")},"createCacheKey");function q(t={}){const e={page:u,per_page:j,row_loop:L,column_order:le,sort_column:D,sort_order:O,sort_type:R,search:x,search_columns:U,filter_by_column_values:$,...t},n=ie(e);return{tableRequest:{...e,column_template:ae,column_sort_type:N},cacheKey:n}}f(q,"E"),o(q,"createTableRequest");function A(t=!1){t?(y.hide(),G.show(),g.removeClass("is-empty-table")):(G.hide(),y.show(),g.addClass("is-empty-table"))}f(A,"j"),o(A,"handleEmptyTable");function v(t={}){const{tableRequest:e,cacheKey:n}=q(t);return new Promise((r,i)=>{if(T[n]){const c=T[n];return r(c)}a.log("fetchTableData",e),g.addClass("loading"),M("tangible_table_data",e).then(function(c){T[n]=c,a.log("fetchTableData success",c),r(c),g.removeClass("loading")}).catch(function(c){a.log("fetchTableData error",c),r(),g.removeClass("loading")})})}f(v,"y"),o(v,"fetchTableData");const{cacheKey:se}=q();T[se]={rows:K,total_pages:_};function I(t){a.log("Get page",t+1),u=t+1,v().then(function(e){e&&m.setPage(t,e.rows)})}f(I,"k"),o(I,"onPaginationChange");function J(t){a.log("onUpdateRowsPerPage",t)}f(J,"ee"),o(J,"onUpdateRowsPerPage");function Q(t,e){u=1,D=t,O=e,R=N[t]||"string",a.log("onColumnSort",u,D,O,R),v().then(function(n){if(!n)return;const r=u-1;m.setPage(r,n.rows)})}f(Q,"te"),o(Q,"onColumnSort");function z(t,e){a.log("onSearch",t,e),u=1,x=t,U=e||m.getVisibleColumns(),v().then(function(n){if(!n)return;a.log("Search result",n),m.setTotalPages(n.total_pages||1);const r=u-1,i=n.rows||[];m.setPage(r,i),A(i.length)})}f(z,"ne"),o(z,"onSearch");const B=g.find(".tangible-table-filter-form");if(!B.length)return;const ce=o(function({$field:t,tag:e,name:n,type:r,action:i,filterColumns:c}){const b=t.val();if(a.log("Filter",i,n,b),i==="loop"||i==="column"){i==="column"?b.length?$[n]={value:b}:delete $[n]:L.attributes[n]=b,v().then(function(w){if(!w)return;_=w.total_pages||1,u>_&&(u=_),m.setTotalPages(_);const ue=u-1,H=w.rows||[];m.setPage(ue,H),A(H.length)});return}if(i==="search"){z(b,c);return}if(i==="perPage"){J(parseInt(b,10));return}},"runFilter");B.each(function(){const t=h(this);t.find("select,input").each(function(){const e=h(this),n=e.prop("tagName").toLowerCase(),r=e.attr("name"),i=n==="select"?"select":e.attr("type"),c=e.data("tangibleTableFilterAction")||"loop",b=e.data("tangibleTableFilterColumns"),w=o(function(){ce({$field:e,tag:n,name:r,type:i,action:c,filterColumns:b})},"onAction");e.on("change",w),i==="text"&&e.on("input",Y(w,500))}),t.on("submit",function(e){e.preventDefault()})})}f(P,"B"),o(P,"activateTable"),h(".tangible-table").each(function(){P(this)}),window.Tangible=window.Tangible||{},window.Tangible.activateTable=P})();
