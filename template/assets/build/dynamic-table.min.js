(function(){"use strict";(function(){const a={env:{NODE_ENV:"production"}};try{if(process){process.env=Object.assign({},process.env),Object.assign(process.env,a);return}}catch(r){}globalThis.process={env:a}})();var z=Object.defineProperty,B=Object.defineProperties,H=Object.getOwnPropertyDescriptors,D=Object.getOwnPropertySymbols,M=Object.prototype.hasOwnProperty,W=Object.prototype.propertyIsEnumerable,$=(a,r,o)=>r in a?z(a,r,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[r]=o,y=(a,r)=>{for(var o in r||(r={}))M.call(r,o)&&$(a,o,r[o]);if(D)for(var o of D(r))W.call(r,o)&&$(a,o,r[o]);return a},E=(a,r)=>B(a,H(r));const d=window.jQuery,{Table:N,ajax:X}=window.Tangible||{},Y=!1,Z=a=>["log","warn","error"].reduce((r,o)=>(r[o]=(...f)=>o==="log"&&!Y?null:window.console[o](`[${a}]`,...f),r),{}),i=Z("Tangible Table"),ee=(a,r)=>{let o;return function(){clearTimeout(o),o=window.setTimeout(()=>a.apply(this,arguments),r)}},R="__tangibleTableRendered";function q(a,r={}){if(!N){i.warn("Library not found");return}const o=typeof a=="string"?document.querySelector(a):a;if(!o){i.warn("Element not found",a);return}if(o[R])return;o[R]=!0;const f=d(o),T=f.data("tangibleTableConfig")||{};i.log("Config",T);const{name:he,rows:A=[],column_label:te={},column_sort_enabled:ne=[],column_sort_type:F={},pagination:oe=!0,pagination_template:ae,empty_table_template:re="",row_loop:K,column_template:ie,column_order:le}=T;let u=1,{per_page:P=-1,total_pages:m,sort_column:C,sort_order:O,sort_type:j}=T,x="",I=[],S={},g=d("<div><div></div></div>");const se=g.find("div")[0],L=E(y({},r),{element:se,data:A,columns:te,sorting:ne,rowsPerPage:P===-1?999:P,pagination:oe,totalPages:m,paginationTemplate:ae,onPaginationChange:ge,onColumnSort:pe}),b=new N(L);i.log("Created",L),f.empty().append(g.find("table").children());const V=g.find(".tangible-table-pagination");V.insertAfter(f),f.wrap('<div class="tangible-table-overflow"></div>');const w=d('<div class="tangible-table-on-empty">'+re+"</div>");w.hide(),w.insertAfter(V),g=f.closest(".tangible-table-container");const k=f,_={},ce=t=>{const e=Object.keys(t);return e.sort(),e.reduce((n,l)=>`${n}${l}=${JSON.stringify(t[l])},`,"")};function G(t={}){const e=y({page:u,per_page:P,row_loop:K,column_order:le,sort_column:C,sort_order:O,sort_type:j,search:x,search_columns:I,filter_by_column_values:S},t),n=ce(e);return{tableRequest:E(y({},e),{column_template:ie,column_sort_type:F}),cacheKey:n}}function J(t=!1){t?(w.hide(),k.show(),g.removeClass("is-empty-table")):(k.hide(),w.show(),g.addClass("is-empty-table"))}function v(t={}){const{tableRequest:e,cacheKey:n}=G(t);return new Promise((l,s)=>{if(_[n]){const c=_[n];return l(c)}i.log("fetchTableData",e),g.addClass("loading"),X("tangible_table_data",e).then(function(c){_[n]=c,i.log("fetchTableData success",c),l(c),g.removeClass("loading")}).catch(function(c){i.log("fetchTableData error",c),l(),g.removeClass("loading")})})}const{cacheKey:ue}=G();_[ue]={rows:A,total_pages:m};function ge(t){i.log("Get page",t+1),u=t+1,v().then(function(e){!e||b.setPage(t,e.rows)})}function fe(t){i.log("onUpdateRowsPerPage",t)}function pe(t,e){u=1,C=t,O=e,j=F[t]||"string",i.log("onColumnSort",u,C,O,j),v().then(function(n){if(!n)return;const l=u-1;b.setPage(l,n.rows)})}function be(t,e){i.log("onSearch",t,e),u=1,x=t,I=e||b.getVisibleColumns(),v().then(function(n){if(!n)return;i.log("Search result",n),b.setTotalPages(n.total_pages||1);const l=u-1,s=n.rows||[];b.setPage(l,s),J(s.length)})}const Q=g.find(".tangible-table-filter-form");if(!Q.length)return;const de=function({$field:t,tag:e,name:n,type:l,action:s,filterColumns:c}){const p=t.val();if(i.log("Filter",s,n,p),s==="loop"||s==="column"){s==="column"?p.length?S[n]={value:p}:delete S[n]:K.attributes[n]=p,v().then(function(h){if(!h)return;m=h.total_pages||1,u>m&&(u=m),b.setTotalPages(m);const me=u-1,U=h.rows||[];b.setPage(me,U),J(U.length)});return}if(s==="search"){be(p,c);return}if(s==="perPage"){fe(parseInt(p,10));return}};Q.each(function(){const t=d(this);t.find("select,input").each(function(){const e=d(this),n=e.prop("tagName").toLowerCase(),l=e.attr("name"),s=n==="select"?"select":e.attr("type"),c=e.data("tangibleTableFilterAction")||"loop",p=e.data("tangibleTableFilterColumns"),h=function(){de({$field:e,tag:n,name:l,type:s,action:c,filterColumns:p})};e.on("change",h),s==="text"&&e.on("input",ee(h,500))}),t.on("submit",function(e){e.preventDefault()})})}d(".tangible-table").each(function(){q(this)}),window.Tangible=window.Tangible||{},window.Tangible.activateTable=q})();
//# sourceMappingURL=dynamic-table.min.js.map
