!function e(i,l,n){function a(o,r){if(!l[o]){if(!i[o]){var c="function"==typeof require&&require;if(!r&&c)return c(o,!0);if(t)return t(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var g=l[o]={exports:{}};i[o][0].call(g.exports,(function(e){return a(i[o][1][e]||e)}),g,g.exports,e,i,l,n)}return l[o].exports}for(var t="function"==typeof require&&require,o=0;o<n.length;o++)a(n[o]);return a}({1:[function(e,i,l){"use strict";jQuery(document).ready((function(e){var i=e("html"),l=e("body"),n=e('<div id="tangible-logic-root"></div>');l.append(n),l.on("click",'[data-tangible-logic="open"]',(function(){var l=e(this).parent().find('[data-tangible-logic="input"]');if(l.length){var r=l.data("tangibleLogicConfig");if("string"==typeof r)try{r=JSON.parse(r)}catch(e){console.warn("tangible/logic - Config failed to parse",r),r=[]}var c=l.val(),u=[];if(c){try{u=JSON.parse(c)}catch(e){console.warn("tangible/logic - Input value failed to parse",c),u=[]}"string"==typeof u&&(u=[])}!function(l,r,c){i.addClass("tangible-logic-hide-scrollbar");var u=e('<div class="tangible-logic-modal"><form>'+function(i,l){var n="";l.title&&(n+='<div class="tangible-logic-title">'+l.title+"</div>");l.description&&(n+='<div class="tangible-logic-description">'+l.description+"</div>");n+='<div class="tangible-logic-rule-groups">',i.length?e.each(i,(function(e,i){n+=t(i,l)})):n+=t([{}],l);return n+="</div>",n+='<div class="tangible-logic-modal-actions tangible-logic-clear"><button type="button" class="tangible-logic-button" data-tangible-logic="add-rule-group">Add rule group</button></div>'}(r,c)+'<div class="tangible-logic-modal-actions tangible-logic-clear"><button type="button" class="tangible-logic-button" data-tangible-logic="save">Save</button><button type="button" class="tangible-logic-button" data-tangible-logic="close">Cancel</button></div></form></div>');n.append(u),n.addClass("tangible-logic-open");var g=u.find("form");g.find('[data-tangible-logic="close"]').on("click",a),g.find('[data-tangible-logic="save"]').on("click",(function(){!function(i,l){var n=function(i){var l=[];return i.find(".tangible-logic-rule-group").each((function(){var i=e(this).find(".tangible-logic-rule"),n=[];i.each((function(){var i={};e(this).find(".tangible-logic-rule-input").each((function(){var l=e(this),n=l.data("tangibleLogicRuleInputName"),a=l.val();""!==a&&(i[n]=a)})),n.push(i)})),l.push(n)})),l}(i);console.log("Tangible logic form result",n),n=JSON.stringify(n),l.val(n),l.trigger("change")}(g,l),a()}));var d=g.find(".tangible-logic-rule-groups");g.find('[data-tangible-logic="add-rule-group"]').on("click",(function(){var e=t([{}],c);d.append(e)})),g.on("click",'[data-tangible-logic="add-rule"]',(function(){var i=e(this).closest(".tangible-logic-rule-group").find(".tangible-logic-rule-group-rules"),l=o({},c);i.append(l)})),g.on("click",'[data-tangible-logic="remove-rule"]',(function(){var i=e(this).closest(".tangible-logic-rule"),l=i.closest(".tangible-logic-rule-group-rules");i.remove(),l.find(".tangible-logic-rule").length||l.closest(".tangible-logic-rule-group").remove()})),c.fieldMap=function(i){var l={};return e.each(i.fields||[],(function(e,i){l[i.name]=i})),l}(c);g.find(".tangible-logic-rule-field-select").each((function(){b(e(this),c)})),g.on("change",".tangible-logic-rule-field-select",(function(i){b(e(this),c)}));g.on("change",".tangible-logic-rule-operand-select",(function(i){p(e(this),c)}))}(l,u,r)}else console.warn("tangible/logic - Input field not found")}));function a(){n.removeClass("tangible-logic-open"),n.empty(),i.removeClass("tangible-logic-hide-scrollbar")}function t(i,l){var n="";return n+='<div class="tangible-logic-rule-group"><div class="tangible-logic-rule-group-separator tangible-logic-clear"><div class="tangible-logic-rule-column">or</div></div>',n+='<div class="tangible-logic-rule-group-box">',n+='<div class="tangible-logic-rule-group-rules">',e.each(i,(function(e,i){n+=o(i,l)})),n+="</div>",n+='<div class="tangible-logic-modal-actions tangible-logic-clear"><button type="button" class="tangible-logic-button" data-tangible-logic="add-rule">Add rule</button></div>',n+="</div></div>"}function o(e,i){return'<div class="tangible-logic-rule tangible-logic-clear" data-tangible-logic-rule-data=\''+x(JSON.stringify(e||{}))+'\'><div class="tangible-logic-rule-columns">'+r("field",function(e,i,l){return g(e,i.field,l.fields,"field")}("tangible_logic[][][field]",e,i))+'</div><div class="tangible-logic-rule-actions"><button type="button" class="tangible-logic-action-icon" data-tangible-logic="remove-rule">Remove</button></div></div>'}function r(e,i){return'<div class="tangible-logic-rule-column tangible-logic-rule-'+e+'"><div class="tangible-logic-rule-column-content">'+i+"</div></div>"}function c(i,l,n,a){var t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(!n)return"";var o="value"+(t?"_"+t:""),r=i.replace("[field]","["+o+"]");if(n[0]&&n[0].type){var c=n[0];if(void 0!==l[o]&&""!==l[o]||void 0===c.default||(l[o]=c.default),"number"===c.type)return d(r,l[o],c,"value",o);if("text"===c.type)return s(r,l[o],c,"value",o);"select"===c.type&&(n=c.options)}var u=[];return e.each(n,(function(e,i){var l=!0;i.operands&&(l=i.operands.indexOf(a)>=0),i.excludeOperands&&(l=i.excludeOperands.indexOf(a)<0),l&&u.push(i)})),u.length?g(r,l[o],u,"value",o):""}function u(e,i,l){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(!l)return"";var a="field"+(n?"_"+n:""),t=e.replace("[field]","["+a+"]");if(l.type){var o=l;if(void 0!==i[a]&&""!==i[a]||void 0===o.default||(i[a]=o.default),"number"===o.type)return d(t,i[a],o,"subfield",a);if("text"===o.type)return s(t,i[a],o,"subfield",a);"select"===o.type&&(l=o.options)}return g(t,i[a],l,"subfield",a)}function g(i,l,n,a,t){var o='<select name="'+i+'"';a&&(o+=' class="tangible-logic-rule-input tangible-logic-rule-'+a+'-select" data-tangible-logic-rule-input-name="'+(t||a)+'"'),o+=">";var r=void 0!==l,c=[];return r||"field"!==a||c.push({name:"",label:"Choose.."}),c=c.concat(n||[]),e.each(c,(function(e,i){if(i){var n=!e&&!r||i.name.toString()===l;o+='<option value="'+i.name+'"'+(n?' selected="selected"':"")+">"+i.label+"</option>"}})),o+="</select>"}function d(i,l,n,a,t){e.isNumeric(l)||(l=0);var o='<input type="number" name="'+i+'"';return a&&(o+=' class="tangible-logic-rule-input tangible-logic-rule-'+a+'-select" data-tangible-logic-rule-input-name="'+(t||a)+'"'),o+=' value="'+(void 0!==l?l:0)+'" min="'+(void 0!==n.min?n.min:0)+'"',n.max&&(o+=' max="'+n.max+'"'),n.step&&(o+=' step="'+n.step+'"'),o+=" />",n.unit&&("string"==typeof n.unit?o+='<span class="tangible-logic-rule-value-unit">'+n.unit+"</span>":(o+='<select name="'+i+'_unit" class="tangible-logic-rule-input tangible-logic-rule-'+a+'-unit-select" data-tangible-logic-rule-input-name="'+(t||a)+'_unit">',e.each(n.unit,(function(e,i){"string"==typeof i&&(i={name:i,label:i}),o+='<option value="'+i.name+'"'+(e?"":' selected="selected"')+">"+i.label+"</option>"})),o+="</select>")),'<div class="tangible-logic-rule-number-input-wrap">'+o+"</div>"}function s(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",l=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0,t='<input type="text" name="'+e+'"';return n&&(t+=' class="tangible-logic-rule-input tangible-logic-rule-'+n+'-select" data-tangible-logic-rule-input-name="'+(a||n)+'"'),t+=' value="'+x(i)+'"'+(l.placeholder?' placeholder="'+l.placeholder+'"':"")+" />"}function f(e,i){var l=e[i+"_label"]||"";return l?'<label class="tangible-logic-rule-input-label">'+l+"</label>":l}function v(e,i){var l=e[i+"_description"]||"";return l?'<div class="tangible-logic-rule-input-description">'+l+"</div>":l}function b(i,l){var n=i.attr("name"),a=i.val(),t=i.closest(".tangible-logic-rule"),o=t.find(".tangible-logic-rule-columns"),c=t.find(".tangible-logic-rule-subfield"),d=t.find(".tangible-logic-rule-operand"),s=t.find(".tangible-logic-rule-value"),b=t.find(".tangible-logic-rule-subvalue");if(c.remove(),d.remove(),s.remove(),b.remove(),a){var m=t.data("tangibleLogicRuleData")||{},h=l.fieldMap[a]||{},y=t.find(".tangible-logic-rule-field .tangible-logic-rule-column-content"),x=f(h,"field"),_=v(h,"field");y.find(".tangible-logic-rule-input-label").remove(),y.find(".tangible-logic-rule-input-description").remove(),x&&y.prepend(e(x)),_&&y.append(e(_));for(var O=0;O<3;O++){var k=O+2,w=h["field_"+k];if(!w)break;o.append(r("subfield",u(n,m,w,k)))}h.operands&&o.append(r("operand",function(e,i,l){var n=e.replace("[field]","[operand]");if(!l||!l.length)return"";for(var a=!1,t=0,o=l.length;t<o;t++)l[t].name===i.operand&&(a=!0);return!a&&l[0]&&l[0].name&&(i.operand=l[0].name),g(n,i.operand,l,"operand")}(n,m,h.operands))),p(o.find(".tangible-logic-rule-operand-select"),l,t)}}function p(i,l,n){var a,t;if(i.length)a=i.closest(".tangible-logic-rule"),t=i.val();else{if(!n)return;a=n,t=""}var o=a.find(".tangible-logic-rule-columns"),u=a.find(".tangible-logic-rule-field-select"),g=u.attr("name"),d=u.val();if(d){var s=a.data("tangibleLogicRuleData")||{};a.data("tangibleLogicRuleData",{});var b=a.find(".tangible-logic-rule-value");b.length&&(s.value=b.find(".tangible-logic-rule-value-select").val());var p=a.find(".tangible-logic-rule-subvalue");p.each((function(i){e(this).find(".tangible-logic-rule-input").each((function(){var i=e(this),l=i.data("tangibleLogicRuleInputName");s[l]=i.val()}))})),b.remove(),p.remove();var y=l.fieldMap[d]||{};if(y.values){if(t&&y.operands)for(var x=0,_=y.operands.length;x<_;x++)if(y.operands[x]&&y.operands[x].name===t){if(!1===y.operands[x].value)return;break}var O=r("value",D("values",c(g,s,y.values,t)));y.values.length>0&&y.values[0].hasOwnProperty("before_operand")&&!0===y.values[0].before_operand?a.find(".tangible-logic-rule-operand").before(O):o.append(O);for(var k=m(y.values,"values",[]),w=0;w<3;w++){var C=w+2,N="values_"+C,L=y[N];if(!L)break;var S=r("subvalue",D(N,c(g,s,L,t,C)));L.length>0&&L[0].hasOwnProperty("before_operand")&&!0===L[0].before_operand?a.find(".tangible-logic-rule-operand").before(S):o.append(S),k=m(L,N,k)}!function(e,i){for(var l=0;l<e.length;l++)h(e[l].name,e[l].config,i)}(k,a)}}function D(e,i){return f(y,e)+i+v(y,e)}}function m(e,i,l){if(void 0===e[0]||void 0===e[0].type)return l;if(void 0===e[0].visibility)return l;var n=e[0].visibility;return l.push({name:i,config:n}),l}function h(e,i,l){for(var n=!1,a=0;a<i.length;a++){var t=l.find('select[name="tangible_logic[][]['+i[a].field.replace("s","")+']"]');(i[a].value.constructor===Array&&-1!==i[a].value.indexOf(t.val())||i[a].value===t.val())&&(n=!0)}var o=l.find('select[name="tangible_logic[][]['+e.replace("s","")+']"]').parent().parent();!1!==n?o.show():o.hide()}var y={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function x(e){return String(e).replace(/[&<>"'`=\/]/g,(function(e){return y[e]}))}}))},{}]},{},[1]);
//# sourceMappingURL=tangible-logic.js.map
