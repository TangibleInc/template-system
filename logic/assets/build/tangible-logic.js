(function(){"use strict";(function(){const c={env:{NODE_ENV:"production"}};try{if(process){process.env=Object.assign({},process.env),Object.assign(process.env,c);return}}catch(C){}globalThis.process={env:c}})(),jQuery(document).ready(function(c){var C=c("html"),L=c("body"),h=c('<div id="tangible-logic-root"></div>');L.append(h),L.on("click",'[data-tangible-logic="open"]',function(){var l=c(this).parent().find('[data-tangible-logic="input"]');if(!l.length){console.warn("tangible/logic - Input field not found");return}var i=l.data("tangibleLogicConfig");if(typeof i=="string")try{i=JSON.parse(i)}catch(n){console.warn("tangible/logic - Config failed to parse",i),i=[]}var e=l.val(),t=[];if(e){try{t=JSON.parse(e)}catch(n){console.warn("tangible/logic - Input value failed to parse",e),t=[]}typeof t=="string"&&(t=[])}z(l,t,i)});var R="tangible-logic-open",S="tangible-logic-hide-scrollbar";function D(){h.removeClass(R),h.empty(),C.removeClass(S)}var V='<div class="tangible-logic-modal-actions tangible-logic-clear"><button type="button" class="tangible-logic-button" data-tangible-logic="save">Save</button><button type="button" class="tangible-logic-button" data-tangible-logic="close">Cancel</button></div>';function z(l,i,e){C.addClass(S);var t=c('<div class="tangible-logic-modal"><form>'+F(i,e)+V+"</form></div>");h.append(t),h.addClass(R);var n=t.find("form");n.find('[data-tangible-logic="close"]').on("click",D),n.find('[data-tangible-logic="save"]').on("click",function(){U(n,l),D()});var a=n.find(".tangible-logic-rule-groups");n.find('[data-tangible-logic="add-rule-group"]').on("click",function(){var u=w([{}],e);a.append(u)}),n.on("click",'[data-tangible-logic="add-rule"]',function(){var u=c(this).closest(".tangible-logic-rule-group").find(".tangible-logic-rule-group-rules"),s=I({},e);u.append(s)}),n.on("click",'[data-tangible-logic="remove-rule"]',function(){var u=c(this).closest(".tangible-logic-rule"),s=u.closest(".tangible-logic-rule-group-rules");u.remove();var d=s.find(".tangible-logic-rule");d.length||s.closest(".tangible-logic-rule-group").remove()}),e.fieldMap=B(e);var o=".tangible-logic-rule-field-select";n.find(o).each(function(){P(c(this),e)}),n.on("change",o,function(u){P(c(this),e)});var r=".tangible-logic-rule-operand-select";n.on("change",r,function(u){T(c(this),e)})}function B(l){var i={};return c.each(l.fields||[],function(e,t){i[t.name]=t}),i}function F(l,i){var e="";return i.title&&(e+='<div class="tangible-logic-title">'+i.title+"</div>"),i.description&&(e+='<div class="tangible-logic-description">'+i.description+"</div>"),e+='<div class="tangible-logic-rule-groups">',l.length?c.each(l,function(t,n){e+=w(n,i)}):e+=w([{}],i),e+="</div>",e+='<div class="tangible-logic-modal-actions tangible-logic-clear"><button type="button" class="tangible-logic-button" data-tangible-logic="add-rule-group">Add rule group</button></div>',e}function w(l,i){var e="";return e+='<div class="tangible-logic-rule-group"><div class="tangible-logic-rule-group-separator tangible-logic-clear"><div class="tangible-logic-rule-column">or</div></div>',e+='<div class="tangible-logic-rule-group-box">',e+='<div class="tangible-logic-rule-group-rules">',c.each(l,function(t,n){e+=I(n,i)}),e+="</div>",e+='<div class="tangible-logic-modal-actions tangible-logic-clear"><button type="button" class="tangible-logic-button" data-tangible-logic="add-rule">Add rule</button></div>',e+="</div></div>",e}function I(l,i){var e="tangible_logic[][][field]",t=`<div class="tangible-logic-rule tangible-logic-clear" data-tangible-logic-rule-data='`+Q(JSON.stringify(l||{}))+`'><div class="tangible-logic-rule-columns">`+y("field",H(e,l,i))+'</div><div class="tangible-logic-rule-actions"><button type="button" class="tangible-logic-action-icon" data-tangible-logic="remove-rule">Remove</button></div></div>';return t}function y(l,i){return'<div class="tangible-logic-rule-column tangible-logic-rule-'+l+'"><div class="tangible-logic-rule-column-content">'+i+"</div></div>"}function G(l,i,e){var t=l.replace("[field]","[operand]");if(!e||!e.length)return"";var n=!1;for(let a=0,o=e.length;a<o;a++)e[a].name===i.operand&&(n=!0);return!n&&e[0]&&e[0].name&&(i.operand=e[0].name),N(t,i.operand,e,"operand")}function J(l,i,e,t,n=0){if(!e)return"";var a="value"+(n?"_"+n:""),o=l.replace("[field]","["+a+"]");if(e[0]&&e[0].type){var r=e[0];if((i[a]===void 0||i[a]==="")&&r.default!==void 0&&(i[a]=r.default),r.type==="number")return j(o,i[a],r,"value",a);if(r.type==="text")return A(o,i[a],r,"value",a);r.type==="select"&&(e=r.options)}var u=[];return c.each(e,function(s,d){var f=!0;d.operands&&(f=d.operands.indexOf(t)>=0),d.excludeOperands&&(f=d.excludeOperands.indexOf(t)<0),f&&u.push(d)}),u.length?N(o,i[a],u,"value",a):""}function H(l,i,e){return N(l,i.field,e.fields,"field")}function K(l,i,e,t=0){if(!e)return"";var n="field"+(t?"_"+t:""),a=l.replace("[field]","["+n+"]");if(e.type){var o=e;if((i[n]===void 0||i[n]==="")&&o.default!==void 0&&(i[n]=o.default),o.type==="number")return j(a,i[n],o,"subfield",n);if(o.type==="text")return A(a,i[n],o,"subfield",n);o.type==="select"&&(e=o.options)}return N(a,i[n],e,"subfield",n)}function N(l,i,e,t,n){var a='<select name="'+l+'"';t&&(a+=' class="tangible-logic-rule-input tangible-logic-rule-'+t+'-select" data-tangible-logic-rule-input-name="'+(n||t)+'"'),a+=">";var o=i!==void 0,r=[];return!o&&t==="field"&&r.push({name:"",label:"Choose.."}),r=r.concat(e||[]),c.each(r,function(u,s){if(s){var d=!u&&!o||s.name.toString()===i;a+='<option value="'+s.name+'"'+(d?' selected="selected"':"")+">"+s.label+"</option>"}}),a+="</select>",a}function j(l,i,e,t,n){c.isNumeric(i)||(i=0);var a='<input type="number" name="'+l+'"';return t&&(a+=' class="tangible-logic-rule-input tangible-logic-rule-'+t+'-select" data-tangible-logic-rule-input-name="'+(n||t)+'"'),a+=' value="'+(i!==void 0?i:0)+'" min="'+(e.min!==void 0?e.min:0)+'"',e.max&&(a+=' max="'+e.max+'"'),e.step&&(a+=' step="'+e.step+'"'),a+=" />",e.unit&&(typeof e.unit=="string"?a+='<span class="tangible-logic-rule-value-unit">'+e.unit+"</span>":(a+='<select name="'+l+'_unit" class="tangible-logic-rule-input tangible-logic-rule-'+t+'-unit-select" data-tangible-logic-rule-input-name="'+(n||t)+'_unit">',c.each(e.unit,function(o,r){typeof r=="string"&&(r={name:r,label:r}),a+='<option value="'+r.name+'"'+(o?"":' selected="selected"')+">"+r.label+"</option>"}),a+="</select>")),'<div class="tangible-logic-rule-number-input-wrap">'+a+"</div>"}function A(l,i="",e,t,n){var a='<input type="text" name="'+l+'"';return t&&(a+=' class="tangible-logic-rule-input tangible-logic-rule-'+t+'-select" data-tangible-logic-rule-input-name="'+(n||t)+'"'),a+=' value="'+Q(i)+'"'+(e.placeholder?' placeholder="'+e.placeholder+'"':"")+" />",a}function M(l,i){var e=l[i+"_label"]||"";return e&&'<label class="tangible-logic-rule-input-label">'+e+"</label>"}function E(l,i){var e=l[i+"_description"]||"";return e&&'<div class="tangible-logic-rule-input-description">'+e+"</div>"}function P(l,i){var e=l.attr("name"),t=l.val(),n=l.closest(".tangible-logic-rule"),a=n.find(".tangible-logic-rule-columns"),o=n.find(".tangible-logic-rule-subfield"),r=n.find(".tangible-logic-rule-operand"),u=n.find(".tangible-logic-rule-value"),s=n.find(".tangible-logic-rule-subvalue");if(o.remove(),r.remove(),u.remove(),s.remove(),!!t){var d=n.data("tangibleLogicRuleData")||{},f=i.fieldMap[t]||{},g=n.find(".tangible-logic-rule-field .tangible-logic-rule-column-content"),_=M(f,"field"),x=E(f,"field");g.find(".tangible-logic-rule-input-label").remove(),g.find(".tangible-logic-rule-input-description").remove(),_&&g.prepend(c(_)),x&&g.append(c(x));for(let m=0;m<3;m++){const O=m+2,k="field_"+O,b=f[k];if(!b)break;a.append(y("subfield",K(e,d,b,O)))}f.operands&&a.append(y("operand",G(e,d,f.operands))),T(a.find(".tangible-logic-rule-operand-select"),i,n)}}function T(l,i,e){var t,n;if(l.length)t=l.closest(".tangible-logic-rule"),n=l.val();else{if(!e)return;t=e,n=""}var a=t.find(".tangible-logic-rule-columns"),o=t.find(".tangible-logic-rule-field-select"),r=o.attr("name"),u=o.val();if(!u)return;var s=t.data("tangibleLogicRuleData")||{};t.data("tangibleLogicRuleData",{});var d=t.find(".tangible-logic-rule-value");d.length&&(s.value=d.find(".tangible-logic-rule-value-select").val());var f=t.find(".tangible-logic-rule-subvalue");f.each(function(v){c(this).find(".tangible-logic-rule-input").each(function(){var p=c(this),$=p.data("tangibleLogicRuleInputName");s[$]=p.val()})}),d.remove(),f.remove();var g=i.fieldMap[u]||{};if(!g.values)return;if(n&&g.operands){for(let v=0,p=g.operands.length;v<p;v++)if(!(!g.operands[v]||g.operands[v].name!==n)){if(g.operands[v].value===!1)return;break}}function _(v,p){return M(g,v)+p+E(g,v)}const x=y("value",_("values",J(r,s,g.values,n)));g.values.length>0&&g.values[0].hasOwnProperty("before_operand")&&g.values[0].before_operand===!0?t.find(".tangible-logic-rule-operand").before(x):a.append(x);let m=q(g.values,"values",[]);for(let v=0;v<3;v++){var O=v+2,k="values_"+O,b=g[k];if(!b)break;const p=y("subvalue",_(k,J(r,s,b,n,O)));b.length>0&&b[0].hasOwnProperty("before_operand")&&b[0].before_operand===!0?t.find(".tangible-logic-rule-operand").before(p):a.append(p),m=q(b,k,m)}X(m,t)}function U(l,i){var e=W(l);console.log("Tangible logic form result",e),e=JSON.stringify(e),i.val(e),i.trigger("change")}function W(l){var i=[];return l.find(".tangible-logic-rule-group").each(function(){var e=c(this).find(".tangible-logic-rule"),t=[];e.each(function(){var n={};c(this).find(".tangible-logic-rule-input").each(function(){var a=c(this),o=a.data("tangibleLogicRuleInputName"),r=a.val();r!==""&&(n[o]=r)}),t.push(n)}),i.push(t)}),i}function q(l,i,e){if(l[0]===void 0||l[0].type===void 0||l[0].visibility===void 0)return e;var t=l[0].visibility;return e.push({name:i,config:t}),e}function X(l,i){for(let e=0;e<l.length;e++)Y(l[e].name,l[e].config,i)}function Y(l,i,e){let t=!1;for(let a=0;a<i.length;a++){let o=e.find('select[name="tangible_logic[][]['+i[a].field.replace("s","")+']"]');(i[a].value.constructor===Array&&i[a].value.indexOf(o.val())!==-1||i[a].value===o.val())&&(t=!0)}let n=e.find('select[name="tangible_logic[][]['+l.replace("s","")+']"]').parent().parent();t!==!1?n.show():n.hide()}const Z={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function Q(l){return String(l).replace(/[&<>"'`=\/]/g,function(i){return Z[i]})}})})();
//# sourceMappingURL=tangible-logic.js.map
