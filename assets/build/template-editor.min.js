(function(){"use strict";(function(){const o={env:{NODE_ENV:"production"}};try{if(process){process.env=Object.assign({},process.env),Object.assign(process.env,o);return}}catch(n){}globalThis.process={env:o}})();var S=Object.defineProperty,x=Object.defineProperties,N=Object.getOwnPropertyDescriptors,g=Object.getOwnPropertySymbols,C=Object.prototype.hasOwnProperty,A=Object.prototype.propertyIsEnumerable,y=(o,n,s)=>n in o?S(o,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):o[n]=s,u=(o,n)=>{for(var s in n||(n={}))C.call(n,s)&&y(o,s,n[s]);if(g)for(var s of g(n))A.call(n,s)&&y(o,s,n[s]);return o},w=(o,n)=>x(o,N(n));jQuery(function(o){const n=o("#post"),s=n.find("[data-tangible-template-editor-type]");s.length||console.warn("No editor elements found for Tangible Template code editor");const p={},_=o("#post_ID").val(),D=n.find('input[name="post_title"]'),c=o("#publish"),j=c.closest("#major-publishing-actions"),f=n.find("#tangible-template-editor-meta").data("json")||{},{ajax:$,createCodeEditor:F}=window.Tangible,T=["name","assets","location","theme_position","theme_header","theme_footer","universal_id"],d={};for(const t of T){const e=n.find(`[name="${t}"]`);e.length&&(d[t]=e)}const O=["tangible_template_category"],m={};for(const t of O){const e=n.find(`[type="checkbox"][name="tax_input[${t}][]"]`);e.length&&(m[t]=e,e.each(function(){const i=this.getAttribute("checked")==="checked";o(this).prop("checked",i)}))}const k=function(t,e){c.val(t),e?j.append(`<div id="post-save-error-message" style="padding-top: 8px">${e}</div>`):j.find("#post-save-error-message").remove()},I=function(){const t={};for(let e in p){const i=p[e];e==="post_content"&&(e="content");const a=i.getValue();t[e]=a}return t},L=function(){const t={};for(const e of T)!d[e]||(t[e]=d[e].val());return t},q=function(){const t={};for(const e of O)!m[e]||(t[e]=[],m[e].each(function(){const i=o(this);i.prop("checked")&&t[e].push(i.val())}));return t},b=function(){if(f.isNewPost){c.click();return}if(!_)return;const t=D.val();if(!t)return;const e=w(u(u({title:t,id:_,content:""},I()),L()),{tax_input:q()}),i=c.val();let a;function r(){a&&clearTimeout(a),a=setTimeout(function(){c.val(i)},4e3)}c.val("Saving.."),$("tangible_template_editor_save",e).then(function(l){k("Saved"),r()}).catch(function(l){k("Error",l.message),r()})};!f.isNewPost&&f.postStatus==="publish"&&c.on("click",function(t){t.preventDefault(),b()});const z={viewportMargin:1/0,resizable:!1,lineWrapping:!0,extraKeys:{"Alt-F":"findPersistent","Ctrl-S":b,"Cmd-S":b,Tab:"emmetExpandAbbreviation",Esc:"emmetResetAbbreviation",Enter:"emmetInsertLineBreak","Ctrl-Space":"autocomplete"}};s.each(function(){const t=o(this),e=t.attr("name"),i=t.data("tangibleTemplateEditorType"),a=w(u({},z),{language:i});i==="html"&&(a.emmet={preview:!1,config:{html:{Loop:"Loop[type]",Field:"Field/"}}});const r=p[e]=F(this,a);r.setSize(null,"100%"),e==="post_content"&&!f.isNewPost&&r.focus()});const h=n.find(".tangible-template-tab-selector"),E=n.find(".tangible-template-tab"),P=[];if(!E.length){console.warn("No tabs elements found for Tangible Template code editor");return}h.on("click",function(){const t=this;h.each(function(e){const i=o(this),a=E.eq(e);if(this!==t){i.removeClass("active"),a.hide();return}i.addClass("active"),a.show();const r=a.find("[data-tangible-template-editor-type]"),l=r.length?p[r.attr("name")]:!1;P[e]||(P[e]=!0,l&&l.refresh()),l&&l.focus()})});const v=window.location.search.substr(1).split("&").reduce(function(t,e){const[i,a]=e.split("=");return t[i]=a,t},{});if(v.tab){const t=h.filter(`[data-tab-name="${v.tab}"]`);t.length?t.eq(0).click():console.warn("Tab not found",v.tab)}})})();
//# sourceMappingURL=template-editor.min.js.map
