{"version":3,"file":"template-editor.min.js","sources":["../src/template-editor/compat.ts","../src/template-editor/index.ts"],"sourcesContent":["/**\n * Compatibility layer  to help with transition of CodeMirror 5 to 6\n */\n\ndeclare global {\n  interface Window {\n    wp: any,\n    Tangible: {\n      ajax: any,\n      TemplateSystem: any,\n      // Legacy\n      createCodeEditor: (el: HTMLElement, options?: {}) =>\n        CodeEditorLegacyInterface,\n    }\n  }\n}\n\nexport type CodeEditorLegacyInterface = {\n  getValue: () => string,\n  focus: () => void,\n  refresh: () => void,\n  setSize: (width: string | null, height: string | null) => void\n}\n\nexport type CodeEditorLegacyOptions = {\n  language?: string,\n  onSave?: () => void\n}\n\nexport async function createTemplateEditor(\n  textarea: HTMLTextAreaElement,\n  options: CodeEditorLegacyOptions = {}\n): Promise<CodeEditorLegacyInterface & {\n  updateTextarea: () => void\n}> {\n\n  const { CodeEditor } = window.Tangible.TemplateSystem || {}\n\n  if (!CodeEditor) {\n    throw new Error('CodeEditor not found')\n  }\n\n  // console.log('createTemplateEditor', textarea, CodeEditor, options)\n\n  const {\n    language = 'html',\n    onSave\n  } = options\n\n  const editor = await CodeEditor.create({\n    lang: language,\n    content: textarea.value,\n    // onUpdate(doc) {}\n    onSave() {\n      if (!onSave) return\n      updateTextarea()\n      onSave()\n    }\n  })\n\n  function updateTextarea() {\n    textarea.value = editor.view.state.doc.toString()\n  }\n\n  /**\n   * Support legacy method of passing textarea instead of div container\n   * @see https://codemirror.net/docs/migration/#codemirror.fromtextarea\n   */\n  textarea.parentNode?.insertBefore(editor.view.dom, textarea)\n  if (textarea.form) {\n    textarea.form.addEventListener('submit', () => updateTextarea())\n  }\n\n  return {\n    getValue() {\n      return editor.view.state.doc.toString()\n    },\n    focus() {\n      editor.view.focus()\n    },\n    refresh() {},\n    setSize(width: string | null, height: string | null) {},\n\n    // New editor\n    updateTextarea\n  }\n}\n","/**\n * Editor for template post type\n */\n\nimport { createTemplateEditor } from './compat'\n\n/**\n * Remember state in local storage\n */\n\nconst memoryKey = 'tangibleTemplateEditorState'\n\nconst memory = Object.assign(\n  {\n    tab: undefined, // Default tab\n  },\n  getMemory() || {}\n)\n\nfunction setMemory(state) {\n  if (!window.localStorage) return\n  window.localStorage.setItem(memoryKey, JSON.stringify(state))\n  Object.assign(memory, state)\n}\n\nfunction getMemory() {\n  if (!window.localStorage) return\n  let state = window.localStorage.getItem(memoryKey)\n  if (!state) return\n  try {\n    state = JSON.parse(state)\n    return state\n  } catch (e) {\n    /* Ignore */\n  }\n}\n\njQuery(function ($) {\n  const $postForm = $('#post')\n\n  const $editors = $postForm.find('[data-tangible-template-editor-type]')\n\n  if (!$editors.length) {\n    console.warn('No editor elements found for Tangible Template code editor')\n  }\n\n  // Silence \"Are you sure?\" alert when leaving screen\n  // @see https://core.trac.wordpress.org/browser/branches/5.6/src/js/_enqueues/wp/autosave.js?rev=50366\n  const { wp } = window\n  if (wp && wp.autosave && wp.autosave.server && wp.autosave.server.postChanged) {\n\n    // console.log('Proxy wp.autosave.server.postChanged')\n\n    wp.autosave.server.postChanged = function () {\n      // console.log('postChanged', false)\n      return false\n    }\n  }\n\n\n  const editorInstances = {\n    // fieldName: editor instance\n  }\n\n  const postId = $('#post_ID').val()\n  const $postTitle = $postForm.find('input[name=\"post_title\"]')\n  // const $postContent = $postForm.find('[name=\"post_content\"]') // textarea\n\n  const $publishButton = $('#publish')\n  const $publishingActions = $publishButton.closest('#major-publishing-actions')\n\n  const templateMeta =\n    $postForm.find('#tangible-template-editor-meta').data('json') || {}\n\n  const {\n    ajax,\n    // Provide new editor compatibility layer\n    createCodeEditor = createTemplateEditor\n  } = window.Tangible\n\n  /**\n   * Additional fields that are not editors\n   *\n   * @see /includes/template/fields.php\n   */\n  const additionalFieldNames = [\n    'name',\n    'assets',\n    'location',\n    'theme_position',\n    'theme_header',\n    'theme_footer',\n    'universal_id',\n  ]\n\n  const $additionalFields = {\n    // name?: $element\n  }\n\n  for (const fieldName of additionalFieldNames) {\n    const $field = $postForm.find(`[name=\"${fieldName}\"]`)\n    if ($field.length) {\n      $additionalFields[fieldName] = $field\n    }\n  }\n\n  const taxonomyNames = ['tangible_template_category']\n  const $taxonomyFields = {\n    // name?: $terms\n  }\n\n  for (const taxName of taxonomyNames) {\n    const $terms = $postForm.find(\n      `[type=\"checkbox\"][name=\"tax_input[${taxName}][]\"]`\n    )\n    if ($terms.length) {\n      $taxonomyFields[taxName] = $terms\n\n      /**\n       * Fix browser autocomplete messing with checkboxes..\n       * Force \"checked\" state based on HTML attribute\n       */\n      $terms.each(function () {\n        const checked = this.getAttribute('checked') === 'checked'\n        $(this).prop('checked', checked)\n      })\n    }\n  }\n\n  /**\n   * Show success/error message in publish button\n   */\n  const updatePublishButton = function (newText, errorMessage) {\n    $publishButton.val(newText)\n\n    if (errorMessage) {\n      $publishingActions.append(\n        `<div id=\"post-save-error-message\" style=\"padding-top: 8px\">${errorMessage}</div>`\n      )\n    } else {\n      $publishingActions.find('#post-save-error-message').remove()\n    }\n  }\n\n  const getEditorFields = function () {\n    const data = {}\n\n    for (let fieldName in editorInstances) {\n      const editor = editorInstances[fieldName]\n\n      if (fieldName === 'post_content') fieldName = 'content'\n\n      const value = editor.getValue()\n      data[fieldName] = value\n    }\n\n    return data\n  }\n\n  const getAdditionalFields = function () {\n    const data = {}\n\n    for (const fieldName of additionalFieldNames) {\n      if (!$additionalFields[fieldName]) continue\n      data[fieldName] = $additionalFields[fieldName].val()\n    }\n\n    return data\n  }\n\n  const getTaxonomyFields = function () {\n    const data = {}\n\n    for (const taxName of taxonomyNames) {\n      if (!$taxonomyFields[taxName]) continue\n      data[taxName] = []\n      $taxonomyFields[taxName].each(function () {\n        const $el = $(this)\n        if ($el.prop('checked')) {\n          data[taxName].push($el.val())\n        }\n      })\n    }\n\n    return data\n  }\n\n  /**\n   * Save via AJAX, except for new post which requires page reload\n   */\n  function save() {\n    if (templateMeta.isNewPost) {\n      $publishButton.click()\n      return\n    }\n\n    // New and existing post should have ID\n    if (!postId) return\n\n    const title = $postTitle.val()\n    if (!title) return\n\n    const data = {\n      title,\n      id: postId,\n      content: '',\n      ...getEditorFields(),\n      ...getAdditionalFields(),\n      tax_input: getTaxonomyFields(),\n    }\n\n    const previousLabel = $publishButton.val()\n\n    let labelTimer\n    function restorePreviousLabelAfterTimeout() {\n      if (labelTimer) clearTimeout(labelTimer)\n      labelTimer = setTimeout(function () {\n        $publishButton.val(previousLabel)\n      }, 7000)\n    }\n\n    // $publishButton.val('Saving..')\n\n    ajax('tangible_template_editor_save', data)\n      .then(function (res) {\n        updatePublishButton('Saved')\n        restorePreviousLabelAfterTimeout()\n      })\n      .catch(function (e) {\n        updatePublishButton('Error', e.message)\n        restorePreviousLabelAfterTimeout()\n      })\n  }\n\n  /**\n   * New or draft posts must submit the form and reload the edit screen,\n   * but after that the publish button can use AJAX save.\n   */\n  if (!templateMeta.isNewPost && templateMeta.postStatus === 'publish') {\n    /**\n     * Disable AJAX save until following issues are resolved:\n     *\n     * - AJAX nonce expiring\n     * - Sometimes the post slug not saving?\n     * - Sometimes there's a confirmation dialog \"information you've entered may not be saved\"\n     */\n    /*\n        $publishButton.on('click', function (e) {\n          e.preventDefault()\n          save()\n        })\n    */\n    // window.onbeforeunload = function() {}\n  }\n\n  const sharedEditorOptions = {\n\n    // New editor\n    onSave: save,\n\n    // Legacy editor\n\n    viewportMargin: Infinity, // With .CodeMirror height: auto or 100%\n    resizable: false,\n    lineWrapping: true,\n\n    extraKeys: {\n      'Alt-F': 'findPersistent',\n      'Ctrl-S': save,\n      'Cmd-S': save,\n      Tab: 'emmetExpandAbbreviation',\n      Esc: 'emmetResetAbbreviation',\n      Enter: 'emmetInsertLineBreak',\n      'Ctrl-Space': 'autocomplete',\n    },\n  }\n\n  $editors.each(async function () {\n    const $editor = $(this)\n    const fieldName = $editor.attr('name')\n    const type = $editor.data('tangibleTemplateEditorType') // html, sass, javascript, json\n\n    const editorOptions = {\n      ...sharedEditorOptions,\n      language: type,\n    }\n\n    if (type === 'html') {\n      editorOptions.emmet = {\n        preview: false,\n        config: {\n          // TODO: Emmet custom abbreviations - Currently not working\n          // @see https://github.com/emmetio/codemirror-plugin#emmet-config\n          html: {\n            Loop: 'Loop[type]',\n            Field: 'Field/',\n          },\n        },\n      }\n    }\n\n    const editor = (editorInstances[fieldName] = await createCodeEditor(\n      this,\n      editorOptions\n    ))\n\n    editor.setSize(null, '100%')\n\n    // Focus on content if editing existing post\n    if (fieldName === 'post_content' && !templateMeta.isNewPost) editor.focus()\n\n    // Provide public method to save\n    this.editor = editor\n    editor.save = save\n  })\n\n  // Tabs\n\n  const $tabSelectors = $postForm.find('.tangible-template-tab-selector')\n  const $tabs = $postForm.find('.tangible-template-tab')\n  const tabEditorActivated = [] // index => boolean\n\n  if (!$tabs.length) {\n    console.warn('No tabs elements found for Tangible Template code editor')\n    return\n  }\n\n  $tabSelectors.on('click', function () {\n    const currentTabSelector = this\n\n    // Show current tab, hide others\n\n    $tabSelectors.each(function (index) {\n      const $tabSelector = $(this)\n      const $tab = $tabs.eq(index)\n\n      if (this !== currentTabSelector) {\n        // Hide\n\n        $tabSelector.removeClass('active')\n        $tab.hide()\n\n        return\n      }\n\n      // Show\n\n      $tabSelector.addClass('active')\n      $tab.show()\n\n      // Find editor in tab, if any\n      const $tabEditor = $tab.find('[data-tangible-template-editor-type]')\n      const editorInstance = $tabEditor.length\n        ? editorInstances[\n          $tabEditor.attr('name') // By field name\n        ]\n        : false\n\n      if (!tabEditorActivated[index]) {\n        tabEditorActivated[index] = true\n\n        // Refresh editor once\n        if (editorInstance) {\n          editorInstance.refresh()\n        }\n      }\n\n      if (editorInstance) {\n        editorInstance.focus()\n      }\n\n      setMemory({\n        tab: $tabSelector.data('tabName'),\n        postId,\n      })\n    }) // End for each tab selector\n  }) // End on click tab selector\n\n  /**\n   * Set default tab from URL query parameter\n   */\n\n  const query = window.location.search\n    .substr(1)\n    .split('&')\n    .reduce(function (obj, pair) {\n      const [key, value] = pair.split('=')\n      obj[key] = value\n      return obj\n    }, {})\n\n  const gotoTab = query.tab || (memory.postId === postId && memory.tab)\n\n  if (gotoTab) {\n    // Switch to tab\n\n    const $activeTabSelector = $tabSelectors.filter(\n      `[data-tab-name=\"${gotoTab}\"]`\n    )\n\n    if ($activeTabSelector.length) {\n      $activeTabSelector.eq(0).click()\n    } else {\n      // Ignore if tab not found\n      // console.log('Tab not found', gotoTab)\n    }\n  }\n})\n"],"names":["createTemplateEditor","textarea","options","CodeEditor","language","onSave","editor","updateTextarea","__name","width","height","memoryKey","memory","getMemory","setMemory","state","$","$postForm","$editors","wp","editorInstances","postId","$postTitle","$publishButton","$publishingActions","templateMeta","ajax","createCodeEditor","additionalFieldNames","$additionalFields","fieldName","$field","taxonomyNames","$taxonomyFields","taxName","$terms","checked","updatePublishButton","newText","errorMessage","getEditorFields","data","value","getAdditionalFields","getTaxonomyFields","$el","save","title","previousLabel","labelTimer","restorePreviousLabelAfterTimeout","res","e","sharedEditorOptions","$editor","type","editorOptions","$tabSelectors","$tabs","tabEditorActivated","currentTabSelector","index","$tabSelector","$tab","$tabEditor","editorInstance","gotoTab","obj","pair","key","$activeTabSelector"],"mappings":"2WA6BsB,eAAAA,EACpBC,EACAC,EAAmC,CAAA,EAGlC,CAED,KAAM,CAAE,WAAAC,CAAW,EAAI,OAAO,SAAS,gBAAkB,GAEzD,GAAI,CAACA,EACH,MAAM,IAAI,MAAM,sBAAsB,EAKxC,KAAM,CACJ,SAAAC,EAAW,OACX,OAAAC,CACF,EAAIH,EAEEI,EAAS,MAAMH,EAAW,OAAO,CACrC,KAAMC,EACN,QAASH,EAAS,MAElB,QAAS,CACFI,IACLE,EAAAA,EACAF,EACF,EAAA,CACF,CAAC,EAED,SAASE,GAAiB,CACxBN,EAAS,MAAQK,EAAO,KAAK,MAAM,IAAI,UACzC,CAFSC,OAAAA,EAAAA,EAAAA,KAAAC,EAAAD,EAAA,gBAQTN,EAAAA,EAAS,YAAY,aAAaK,EAAO,KAAK,IAAKL,CAAQ,EACvDA,EAAS,MACXA,EAAS,KAAK,iBAAiB,SAAU,IAAMM,EAAgB,CAAA,EAG1D,CACL,UAAW,CACT,OAAOD,EAAO,KAAK,MAAM,IAAI,SAAS,CACxC,EACA,OAAQ,CACNA,EAAO,KAAK,MAAA,CACd,EACA,SAAU,GACV,QAAQG,EAAsBC,EAAuB,CAAC,EAGtD,eAAAH,CACF,CACF,CAzDsBC,EAAAR,EAAA,wBAAAQ,EAAAR,EAAA,sBAAA,oFCnBtB,MAAMW,EAAY,8BAEZC,EAAS,OAAO,OACpB,CACE,IAAK,MACP,EACAC,EAAe,GAAA,CACjB,CAAA,EAEA,SAASC,EAAUC,EAAO,CACnB,OAAO,eACZ,OAAO,aAAa,QAAQJ,EAAW,KAAK,UAAUI,CAAK,CAAC,EAC5D,OAAO,OAAOH,EAAQG,CAAK,EAC7B,CAJSD,EAAAA,EAAAA,KAAAN,EAAAM,EAAA,WAMT,EAAA,SAASD,GAAY,CACnB,GAAI,CAAC,OAAO,aAAc,OAC1B,IAAIE,EAAQ,OAAO,aAAa,QAAQJ,CAAS,EACjD,GAAKI,EACL,GAAI,CACF,OAAAA,EAAQ,KAAK,MAAMA,CAAK,EACjBA,CACT,MAAE,CAGJ,CAAA,CAVSF,EAAAA,EAAAA,KAAAL,EAAAK,EAAA,WAYT,EAAA,OAAO,SAAUG,EAAG,CAClB,MAAMC,EAAYD,EAAE,OAAO,EAErBE,EAAWD,EAAU,KAAK,sCAAsC,EAEjEC,EAAS,QACZ,QAAQ,KAAK,4DAA4D,EAK3E,KAAM,CAAE,GAAAC,CAAG,EAAI,OACXA,GAAMA,EAAG,UAAYA,EAAG,SAAS,QAAUA,EAAG,SAAS,OAAO,cAIhEA,EAAG,SAAS,OAAO,YAAc,UAAY,CAE3C,MAAO,EACT,GAIF,MAAMC,EAAkB,GAIlBC,EAASL,EAAE,UAAU,EAAE,IAAA,EACvBM,EAAaL,EAAU,KAAK,0BAA0B,EAGtDM,EAAiBP,EAAE,UAAU,EAC7BQ,EAAqBD,EAAe,QAAQ,2BAA2B,EAEvEE,EACJR,EAAU,KAAK,gCAAgC,EAAE,KAAK,MAAM,GAAK,CAAA,EAE7D,CACJ,KAAAS,EAEA,iBAAAC,EAAmB3B,CACrB,EAAI,OAAO,SAOL4B,EAAuB,CAC3B,OACA,SACA,WACA,iBACA,eACA,eACA,cACF,EAEMC,EAAoB,CAAA,EAI1B,UAAWC,KAAaF,EAAsB,CAC5C,MAAMG,EAASd,EAAU,KAAK,UAAUa,KAAa,EACjDC,EAAO,SACTF,EAAkBC,CAAS,EAAIC,GAInC,MAAMC,EAAgB,CAAC,4BAA4B,EAC7CC,EAAkB,GAIxB,UAAWC,KAAWF,EAAe,CACnC,MAAMG,EAASlB,EAAU,KACvB,qCAAqCiB,QACvC,EACIC,EAAO,SACTF,EAAgBC,CAAO,EAAIC,EAM3BA,EAAO,KAAK,UAAY,CACtB,MAAMC,EAAU,KAAK,aAAa,SAAS,IAAM,UACjDpB,EAAE,IAAI,EAAE,KAAK,UAAWoB,CAAO,CACjC,CAAC,GAOL,MAAMC,EAAsB7B,EAAA,SAAU8B,EAASC,EAAc,CAC3DhB,EAAe,IAAIe,CAAO,EAEtBC,EACFf,EAAmB,OACjB,8DAA8De,SAChE,EAEAf,EAAmB,KAAK,0BAA0B,EAAE,OAExD,CAAA,EAV4B,qBAAA,EAYtBgB,EAAkBhC,EAAA,UAAY,CAClC,MAAMiC,EAAO,CAAA,EAEb,QAASX,KAAaV,EAAiB,CACrC,MAAMd,EAASc,EAAgBU,CAAS,EAEpCA,IAAc,iBAAgBA,EAAY,WAE9C,MAAMY,EAAQpC,EAAO,SAAS,EAC9BmC,EAAKX,CAAS,EAAIY,EAGpB,OAAOD,CACT,EAbwB,iBAelBE,EAAAA,EAAsBnC,EAAA,UAAY,CACtC,MAAMiC,EAAO,GAEb,UAAWX,KAAaF,EACjBC,EAAkBC,CAAS,IAChCW,EAAKX,CAAS,EAAID,EAAkBC,CAAS,EAAE,IAAI,GAGrD,OAAOW,CACT,EAT4B,uBAWtBG,EAAoBpC,EAAA,UAAY,CACpC,MAAMiC,EAAO,GAEb,UAAWP,KAAWF,EACfC,EAAgBC,CAAO,IAC5BO,EAAKP,CAAO,EAAI,CAAA,EAChBD,EAAgBC,CAAO,EAAE,KAAK,UAAY,CACxC,MAAMW,EAAM7B,EAAE,IAAI,EACd6B,EAAI,KAAK,SAAS,GACpBJ,EAAKP,CAAO,EAAE,KAAKW,EAAI,KAAK,CAEhC,CAAC,GAGH,OAAOJ,CACT,EAf0B,qBAoB1B,SAASK,GAAO,CACd,GAAIrB,EAAa,UAAW,CAC1BF,EAAe,MAAM,EACrB,OAIF,GAAI,CAACF,EAAQ,OAEb,MAAM0B,EAAQzB,EAAW,MACzB,GAAI,CAACyB,EAAO,OAEZ,MAAMN,EAAO,CACX,MAAAM,EACA,GAAI1B,EACJ,QAAS,GACT,GAAGmB,EACH,EAAA,GAAGG,IACH,UAAWC,GACb,EAEMI,EAAgBzB,EAAe,IAAA,EAErC,IAAI0B,EACJ,SAASC,GAAmC,CACtCD,GAAY,aAAaA,CAAU,EACvCA,EAAa,WAAW,UAAY,CAClC1B,EAAe,IAAIyB,CAAa,CAClC,EAAG,GAAI,CACT,CALSE,EAAAA,OAAA1C,EAAA0C,EAAA,oCASTxB,EAAK,gCAAiCe,CAAI,EACvC,KAAK,SAAUU,EAAK,CACnBd,EAAoB,OAAO,EAC3Ba,GACF,CAAC,EACA,MAAM,SAAUE,EAAG,CAClBf,EAAoB,QAASe,EAAE,OAAO,EACtCF,EAAiC,CACnC,CAAC,CACL,CA1CSJ,EAAAA,EAAAA,KAAAtC,EAAAsC,EAAA,QAgDL,CAACrB,EAAa,WAAaA,EAAa,WAiB5C,MAAM4B,EAAsB,CAG1B,OAAQP,EAIR,eAAgB,IAChB,UAAW,GACX,aAAc,GAEd,UAAW,CACT,QAAS,iBACT,SAAUA,EACV,QAASA,EACT,IAAK,0BACL,IAAK,yBACL,MAAO,uBACP,aAAc,cAChB,CACF,EAEA5B,EAAS,KAAK,gBAAkB,CAC9B,MAAMoC,EAAUtC,EAAE,IAAI,EAChBc,EAAYwB,EAAQ,KAAK,MAAM,EAC/BC,EAAOD,EAAQ,KAAK,4BAA4B,EAEhDE,EAAgB,CACpB,GAAGH,EACH,SAAUE,CACZ,EAEIA,IAAS,SACXC,EAAc,MAAQ,CACpB,QAAS,GACT,OAAQ,CAGN,KAAM,CACJ,KAAM,aACN,MAAO,QACT,CACF,CACF,GAGF,MAAMlD,EAAUc,EAAgBU,CAAS,EAAI,MAAMH,EACjD,KACA6B,CACF,EAEAlD,EAAO,QAAQ,KAAM,MAAM,EAGvBwB,IAAc,gBAAkB,CAACL,EAAa,WAAWnB,EAAO,MAAA,EAGpE,KAAK,OAASA,EACdA,EAAO,KAAOwC,CAChB,CAAC,EAID,MAAMW,EAAgBxC,EAAU,KAAK,iCAAiC,EAChEyC,EAAQzC,EAAU,KAAK,wBAAwB,EAC/C0C,EAAqB,CAAA,EAE3B,GAAI,CAACD,EAAM,OAAQ,CACjB,QAAQ,KAAK,0DAA0D,EACvE,OAGFD,EAAc,GAAG,QAAS,UAAY,CACpC,MAAMG,EAAqB,KAI3BH,EAAc,KAAK,SAAUI,EAAO,CAClC,MAAMC,EAAe9C,EAAE,IAAI,EACrB+C,EAAOL,EAAM,GAAGG,CAAK,EAE3B,GAAI,OAASD,EAAoB,CAG/BE,EAAa,YAAY,QAAQ,EACjCC,EAAK,KAAA,EAEL,OAKFD,EAAa,SAAS,QAAQ,EAC9BC,EAAK,KAAK,EAGV,MAAMC,EAAaD,EAAK,KAAK,sCAAsC,EAC7DE,EAAiBD,EAAW,OAC9B5C,EACA4C,EAAW,KAAK,MAAM,CACxB,EACE,GAECL,EAAmBE,CAAK,IAC3BF,EAAmBE,CAAK,EAAI,GAGxBI,GACFA,EAAe,WAIfA,GACFA,EAAe,MAGjBnD,EAAAA,EAAU,CACR,IAAKgD,EAAa,KAAK,SAAS,EAChC,OAAAzC,CACF,CAAC,CACH,CAAC,CACH,CAAC,EAeD,MAAM6C,EATQ,OAAO,SAAS,OAC3B,OAAO,CAAC,EACR,MAAM,GAAG,EACT,OAAO,SAAUC,EAAKC,EAAM,CAC3B,KAAM,CAACC,EAAK3B,CAAK,EAAI0B,EAAK,MAAM,GAAG,EACnC,OAAAD,EAAIE,CAAG,EAAI3B,EACJyB,CACT,EAAG,CAAE,CAAA,EAEe,KAAQvD,EAAO,SAAWS,GAAUT,EAAO,IAEjE,GAAIsD,EAAS,CAGX,MAAMI,EAAqBb,EAAc,OACvC,mBAAmBS,KACrB,EAEII,EAAmB,QACrBA,EAAmB,GAAG,CAAC,EAAE,QAM/B,CAAC"}