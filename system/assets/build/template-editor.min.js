var Q=Object.defineProperty;var u=(P,k)=>Q(P,"name",{value:k,configurable:!0});(function(){"use strict";(function(){const o={NODE_ENV:"production"};try{if(process){process.env=Object.assign({},process.env),Object.assign(process.env,o);return}}catch{}globalThis.process={env:o}})();var P=Object.defineProperty,k=u((o,e)=>P(o,"name",{value:e,configurable:!0}),"e");const N="tangibleTemplateEditorState",M=Object.assign({tab:void 0,postId:0,theme:"default",fontFamily:"default",fontSize:14},j()||{});function E(o){window.localStorage&&(Object.assign(M,o),window.localStorage.setItem(N,JSON.stringify(M)))}u(E,"setMemory"),k(E,"setMemory");function j(){if(!window.localStorage)return;let o=window.localStorage.getItem(N);if(o)try{return o=JSON.parse(o),o}catch{}}u(j,"getMemory"),k(j,"getMemory");var B=Object.defineProperty,J=u((o,e)=>B(o,"name",{value:e,configurable:!0}),"u");function L({$:o,postId:e,$postForm:a,editorInstances:m}){const v=a.find(".tangible-template-tab-selector"),b=a.find(".tangible-template-tab"),y=[];if(!b.length){console.warn("No tabs elements found for Tangible Template code editor");return}v.on("click",function(){const s=this;v.each(function(r){const c=o(this),p=c.data("tabName"),g=b.eq(r);if(this!==s){c.removeClass("active"),g.hide();return}c.addClass("active"),g.show();const f=g.find("[data-tangible-template-editor-type]"),h=f.length?m[f.attr("name")]:!1;y[r]||(y[r]=!0,h&&h.refresh()),h&&h.focus(),E({tab:p,postId:e})})});const d=window.location.search.substr(1).split("&").reduce(function(s,r){const[c,p]=r.split("=");return s[c]=p,s},{}).tab||M.postId===e&&M.tab;if(d){const s=v.filter(`[data-tab-name="${d}"]`);s.length&&s.eq(0).click()}}u(L,"handleTabs"),J(L,"handleTabs");var U=Object.defineProperty,S=u((o,e)=>U(o,"name",{value:e,configurable:!0}),"f");async function O({$:o,save:e,$editors:a,editorInstances:m,createCodeEditor:v,templateMeta:b,Tangible:y}){const d={onSave:e,viewportMargin:1/0,resizable:!1,lineWrapping:!0,extraKeys:{"Alt-F":"findPersistent","Ctrl-S":e,"Cmd-S":e,Tab:"emmetExpandAbbreviation",Esc:"emmetResetAbbreviation",Enter:"emmetInsertLineBreak","Ctrl-Space":"autocomplete"}},s={listeners:{},on(r,c){s.listeners[r]||(s.listeners[r]=[]),s.listeners[r].push(c)},emit(r,...c){if(s.listeners[r])for(const p of s.listeners[r])p(...c)},clear(){s.listeners={}}};a.each(async function(){const r=o(this),c=r.attr("name"),p=r.data("tangibleTemplateEditorType"),g={...d,language:p,editorActionsPanel(h,w){return w.eventHub||(w.eventHub=s),R(h,w)}};p==="html"&&(g.emmet={preview:!1,config:{html:{Loop:"Loop[type]",Field:"Field/"}}});const f=m[c]=await v(this,g);f.setSize(null,"100%"),c==="post_content"&&!b.isNewPost&&f.focus(),this.editor=f,f.save=e,f.codeMirror6&&(f.eventHub=s,y.codeEditors.push({editor:f,$editor:r,fieldName:c,type:p}))})}u(O,"createEditors"),S(O,"createEditors");const q=[["Anonymous Pro","anonymous-pro","anonymous-pro.woff"],["Cascadia Mono","cascadia-mono","CascadiaMono.woff2"],["Cousine","cousine","cousine-regular.woff"],["Droid Sans Mono","droid-sans-mono","droid-sans-mono.woff2"],["Fira Code","fira-code","FiraCode-Regular.woff2"],["JetBrains Mono","jetbrains-mono","JetBrainsMono-Regular.woff2"],["Menlo","menlo","menlo-regular.woff2"],["Monaspace Neon","monaspace-neon","MonaspaceNeon-Regular.woff"],["Monaspace Xenon","monaspace-xenon","MonaspaceXenon-Regular.woff"],["MonoLisa","monolisa","monolisa-regular.woff2"],["Noto Mono","noto-mono","noto-mono.woff2"],["Office Code Pro","office-code-pro","office-code-pro.woff"],["Operator Mono","operator-mono","operator-mono-medium.woff2"],["SF Mono","sf-mono","sf-mono-regular.woff2"],["Source Code Pro","source-code-pro","SourceCodePro-Regular.woff2"]],T={};async function I(o){if(T[o]){T[o]instanceof Promise&&await T[o];return}T[o]=(async()=>{const{editorUrl:e}=window.Tangible;if(e)for(const[a,m,v]of q){if(o!==m)continue;const b=`${e}/fonts/${v}`,y=new FontFace(m,`url(${b})`);await y.load(),document.fonts.add(y),T[o]=!0;break}})(),await T[o]}u(I,"k"),S(I,"loadFont");function H(o){const e=o.replace(/([A-Z])/g," $1");return e.charAt(0).toUpperCase()+e.slice(1)}u(H,"L"),S(H,"camelCaseToTitle");const A='SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace';function R(o,e){const a=document.createElement("div"),{themes:m={}}=e,v=Object.keys(m).sort().filter(t=>t!=="dark").map(t=>({label:H(t),value:t}));let{theme:b,fontFamily:y,fontSize:d}=M;a.style.backgroundColor="#4c566a",a.style.color="#fff",a.style.padding=".125rem .5rem",a.style.display="flex",a.style.userSelect="none",a.innerHTML=`<div style="flex-grow: 1;"></div><div style="display: flex; text-align:right">
  <div data-action="settings-group" style="display: none; flex-grow: 1;">

    <div data-action="font" style="margin: 0 4px">Font</div>
    <select data-action="font-list" style="margin: 0; padding: 2px 4px; background-color: #2e3440; color: #fff; min-height: 0; border: 0; box-shadow: none; font-size: 12px; line-height: 1">
      <option value="default">Default</option>
      ${q.map(([t,n])=>`<option value="${n}"${n===y?" selected":""}>${t}</option>`)}
    </select>
    <div data-action="font-size" style="padding: 0 4px;">
      <span data-action="font-size-minus" style="cursor: pointer; padding: 2px 4px">-</span>
      <span data-action="font-size-display">${d}</span>
      <span data-action="font-size-plus" style="cursor: pointer; padding: 2px 4px">+</span>
    </div>

    <div data-action="theme" style="margin: 0 4px">Theme</div>
    <select data-action="theme-list" style="margin: 0; padding: 2px 4px; background-color: #2e3440; color: #fff; min-height: 0; border: 0; box-shadow: none; font-size: 12px; line-height: 1">
      <option value="dark">Default</option>
      ${v.map(({label:t,value:n})=>`<option value="${n}"${n===b?" selected":""}>${t}</option>`)}
    </select>

  </div>
  <div data-action="settings" style="margin: 0 4px; cursor: pointer;">Settings</div>
  <div data-action="format" style="margin: 0 4px; cursor: pointer">Format</div>
</div>`,a.querySelector("[data-action=format]")?.addEventListener("click",function(){e.format&&e.format()});const s=a.querySelector("[data-action=settings-group]");function r(t,n=!1){s.style.display=t?"flex":"none",n&&e.eventHub.emit("settingsVisibility",t,e)}u(r,"a"),S(r,"setSettingsVisibility"),a.querySelector("[data-action=settings]")?.addEventListener("click",function(){r(s.style.display==="none",!0)}),e.eventHub.on("settingsVisibility",function(t,n){n!==e&&r(t)});const c=a.querySelector("[data-action=theme-list]");function p(t,n=!1){m[t]&&(e.setTheme(m[t]),n&&(E({theme:t}),e.eventHub.emit("theme",t,e)))}u(p,"l"),S(p,"selectTheme"),c?.addEventListener("change",function(t){const n=t.target.value;p(n,!0)}),e.eventHub.on("theme",function(t,n){n!==e&&(c.value=t,p(t))}),b!=="default"&&setTimeout(()=>p(b),0);const g=a.querySelector("[data-action=font-list]");a.querySelector("[data-action=font-size]");async function f(t,n=!1){const $=o.dom.querySelector(".cm-content");if(!$)return;const z=t==="default";try{z||await I(t)}catch{return}$.style.fontFamily=z?A:`'${t}', ${A}`,n&&(E({fontFamily:t}),e.eventHub.emit("fontFamily",t,e))}u(f,"b"),S(f,"selectFontFamily"),y!=="default"&&setTimeout(()=>f(y),0),g?.addEventListener("change",function(t){const n=t.target.value;f(n,!0)}),e.eventHub.on("fontFamily",function(t,n){n!==e&&(g.value=t,f(t))});const h=a.querySelector("[data-action=font-size-display]");function w(t,n=!1){const $=o.dom.querySelector(".cm-content");$&&($.style.fontSize=`${t}px`,h.innerText=t+"",n&&(E({fontSize:t}),e.eventHub.emit("fontSize",t,e)))}return u(w,"x"),S(w,"selectFontSize"),setTimeout(()=>w(d),0),a.querySelector("[data-action=font-size-minus]").addEventListener("click",function(){d>10&&(d--,w(d,!0))}),a.querySelector("[data-action=font-size-plus]").addEventListener("click",function(){d<100&&(d++,w(d,!0))}),e.eventHub.on("fontSize",function(t,n){n!==e&&w(t)}),{top:!0,dom:a}}u(R,"E$1"),S(R,"editorActionsPanel");var X=Object.defineProperty,F=u((o,e)=>X(o,"name",{value:e,configurable:!0}),"s");window.jQuery(function(o){const e=o("#post"),a=e.find("[data-tangible-template-editor-type]");if(!a.length){console.warn("No editor elements found for Tangible Template code editor");return}const{wp:m}=window;m&&m.autosave&&m.autosave.server&&m.autosave.server.postChanged&&(m.autosave.server.postChanged=function(){return!1});const{Tangible:v}=window,{ajax:b,createCodeEditor:y}=v;v.codeEditors=[];const d={},s=o("#post_ID").val(),r=e.find('input[name="post_title"]'),c=o("#publish"),p=c.closest("#major-publishing-actions"),g=e.find("#tangible-template-editor-meta").data("json")||{},f=["name","assets","location","theme_position","theme_header","theme_footer","universal_id"],h={};for(const l of f){const i=e.find(`[name="${l}"]`);i.length&&(h[l]=i)}const w=["tangible_template_category"],t={};for(const l of w){const i=e.find(`[type="checkbox"][name="tax_input[${l}][]"]`);i.length&&(t[l]=i,i.each(function(){const x=this.getAttribute("checked")==="checked";o(this).prop("checked",x)}))}const n=F(function(l,i=""){c.val(l),i?p.append(`<div id="post-save-error-message" style="padding-top: 8px">${i}</div>`):p.find("#post-save-error-message").remove()},"updatePublishButton"),$=F(function(){const l={};for(let i in d){const x=d[i];i==="post_content"&&(i="content");const C=x.getValue();l[i]=C}return l},"getEditorFields"),z=F(function(){const l={};for(const i of f)h[i]&&(l[i]=h[i].val());return l},"getAdditionalFields"),K=F(function(){const l={};for(const i of w)t[i]&&(l[i]=[],t[i].each(function(){const x=o(this);x.prop("checked")&&l[i].push(x.val())}));return l},"getTaxonomyFields");function D(){if(g.isNewPost){c.click();return}if(!s)return;const l=r.val();if(!l)return;const i={title:l,id:s,content:"",...$(),...z(),tax_input:K()},x=c.val();let C;function _(){C&&clearTimeout(C),C=setTimeout(function(){c.val(x)},7e3)}u(_,"w"),F(_,"restorePreviousLabelAfterTimeout"),b("tangible_template_editor_save",i).then(function(V){n("Saved"),_()}).catch(function(V){n("Error",V.message),_()})}u(D,"j"),F(D,"save"),!g.isNewPost&&g.postStatus,O({$:o,save:D,$editors:a,editorInstances:d,createCodeEditor:y,templateMeta:g,Tangible:v}),L({$:o,postId:s,$postForm:e,editorInstances:d})})})();
//# sourceMappingURL=template-editor.min.js.map
