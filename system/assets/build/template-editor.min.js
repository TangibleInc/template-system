var z=Object.defineProperty;var l=(h,s)=>z(h,"name",{value:s,configurable:!0});(function(){"use strict";(function(){const n={NODE_ENV:"production"};try{if(process){process.env=Object.assign({},process.env),Object.assign(process.env,n);return}}catch{}globalThis.process={env:n}})();var h=Object.defineProperty,s=l((n,r)=>h(n,"name",{value:r,configurable:!0}),"c");const _="tangibleTemplateEditorState",v=Object.assign({tab:void 0},T()||{});function S(n){window.localStorage&&(window.localStorage.setItem(_,JSON.stringify(n)),Object.assign(v,n))}l(S,"L"),s(S,"setMemory");function T(){if(!window.localStorage)return;let n=window.localStorage.getItem(_);if(n)try{return n=JSON.parse(n),n}catch{}}l(T,"q"),s(T,"getMemory"),jQuery(function(n){const r=n("#post"),E=r.find("[data-tangible-template-editor-type]");E.length||console.warn("No editor elements found for Tangible Template code editor");const{wp:d}=window;d&&d.autosave&&d.autosave.server&&d.autosave.server.postChanged&&(d.autosave.server.postChanged=function(){return!1});const f={},m=n("#post_ID").val(),A=r.find('input[name="post_title"]'),u=n("#publish"),N=u.closest("#major-publishing-actions"),g=r.find("#tangible-template-editor-meta").data("json")||{},{ajax:F,createCodeEditor:I}=window.Tangible,j=["name","assets","location","theme_position","theme_header","theme_footer","universal_id"],b={};for(const e of j){const t=r.find(`[name="${e}"]`);t.length&&(b[e]=t)}const k=["tangible_template_category"],w={};for(const e of k){const t=r.find(`[type="checkbox"][name="tax_input[${e}][]"]`);t.length&&(w[e]=t,t.each(function(){const o=this.getAttribute("checked")==="checked";n(this).prop("checked",o)}))}const x=s(function(e,t){u.val(e),t?N.append(`<div id="post-save-error-message" style="padding-top: 8px">${t}</div>`):N.find("#post-save-error-message").remove()},"updatePublishButton"),L=s(function(){const e={};for(let t in f){const o=f[t];t==="post_content"&&(t="content");const i=o.getValue();e[t]=i}return e},"getEditorFields"),$=s(function(){const e={};for(const t of j)b[t]&&(e[t]=b[t].val());return e},"getAdditionalFields"),q=s(function(){const e={};for(const t of k)w[t]&&(e[t]=[],w[t].each(function(){const o=n(this);o.prop("checked")&&e[t].push(o.val())}));return e},"getTaxonomyFields");function p(){if(g.isNewPost){u.click();return}if(!m)return;const e=A.val();if(!e)return;const t={title:e,id:m,content:"",...L(),...$(),tax_input:q()},o=u.val();let i;function a(){i&&clearTimeout(i),i=setTimeout(function(){u.val(o)},7e3)}l(a,"s"),s(a,"restorePreviousLabelAfterTimeout"),F("tangible_template_editor_save",t).then(function(c){x("Saved"),a()}).catch(function(c){x("Error",c.message),a()})}l(p,"p"),s(p,"save"),!g.isNewPost&&g.postStatus;const M={onSave:p,viewportMargin:1/0,resizable:!1,lineWrapping:!0,extraKeys:{"Alt-F":"findPersistent","Ctrl-S":p,"Cmd-S":p,Tab:"emmetExpandAbbreviation",Esc:"emmetResetAbbreviation",Enter:"emmetInsertLineBreak","Ctrl-Space":"autocomplete"}};E.each(async function(){const e=n(this),t=e.attr("name"),o=e.data("tangibleTemplateEditorType"),i={...M,language:o};o==="html"&&(i.emmet={preview:!1,config:{html:{Loop:"Loop[type]",Field:"Field/"}}});const a=f[t]=await I(this,i);a.setSize(null,"100%"),t==="post_content"&&!g.isNewPost&&a.focus(),this.editor=a,a.save=p});const y=r.find(".tangible-template-tab-selector"),C=r.find(".tangible-template-tab"),O=[];if(!C.length){console.warn("No tabs elements found for Tangible Template code editor");return}y.on("click",function(){const e=this;y.each(function(t){const o=n(this),i=C.eq(t);if(this!==e){o.removeClass("active"),i.hide();return}o.addClass("active"),i.show();const a=i.find("[data-tangible-template-editor-type]"),c=a.length?f[a.attr("name")]:!1;O[t]||(O[t]=!0,c&&c.refresh()),c&&c.focus(),S({tab:o.data("tabName"),postId:m})})});const P=window.location.search.substr(1).split("&").reduce(function(e,t){const[o,i]=t.split("=");return e[o]=i,e},{}).tab||v.postId===m&&v.tab;if(P){const e=y.filter(`[data-tab-name="${P}"]`);e.length&&e.eq(0).click()}})})();
//# sourceMappingURL=template-editor.min.js.map
