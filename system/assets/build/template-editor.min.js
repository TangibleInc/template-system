var Q=Object.defineProperty;var u=(P,k)=>Q(P,"name",{value:k,configurable:!0});(function(){"use strict";(function(){const t={NODE_ENV:"production"};try{if(process){process.env=Object.assign({},process.env),Object.assign(process.env,t);return}}catch{}globalThis.process={env:t}})();var P=Object.defineProperty,k=u((t,e)=>P(t,"name",{value:e,configurable:!0}),"e");const N="tangibleTemplateEditorState",F=Object.assign({tab:void 0,postId:0,theme:"default",fontFamily:"default",fontSize:14},j()||{});function E(t){window.localStorage&&(Object.assign(F,t),window.localStorage.setItem(N,JSON.stringify(F)))}u(E,"setMemory"),k(E,"setMemory");function j(){if(!window.localStorage)return;let t=window.localStorage.getItem(N);if(t)try{return t=JSON.parse(t),t}catch{}}u(j,"getMemory"),k(j,"getMemory");var B=Object.defineProperty,J=u((t,e)=>B(t,"name",{value:e,configurable:!0}),"u");function O({$:t,postId:e,$postForm:a,editorInstances:m}){const v=a.find(".tangible-template-tab-selector"),b=a.find(".tangible-template-tab"),y=[];if(!b.length){console.warn("No tabs elements found for Tangible Template code editor");return}v.on("click",function(){const s=this;v.each(function(r){const c=t(this),p=c.data("tabName"),g=b.eq(r);if(this!==s){c.removeClass("active"),g.hide();return}c.addClass("active"),g.show();const f=g.find("[data-tangible-template-editor-type]"),h=f.length?m[f.attr("name")]:!1;y[r]||(y[r]=!0,h&&h.refresh()),h&&h.focus(),E({tab:p,postId:e})})});const d=window.location.search.substr(1).split("&").reduce(function(s,r){const[c,p]=r.split("=");return s[c]=p,s},{}).tab||F.postId===e&&F.tab;if(d){const s=v.filter(`[data-tab-name="${d}"]`);s.length&&s.eq(0).click()}}u(O,"handleTabs"),J(O,"handleTabs");var U=Object.defineProperty,S=u((t,e)=>U(t,"name",{value:e,configurable:!0}),"f");async function q({$:t,save:e,$editors:a,editorInstances:m,createCodeEditor:v,templateMeta:b,Tangible:y}){const d={onSave:e,viewportMargin:1/0,resizable:!1,lineWrapping:!0,extraKeys:{"Alt-F":"findPersistent","Ctrl-S":e,"Cmd-S":e,Tab:"emmetExpandAbbreviation",Esc:"emmetResetAbbreviation",Enter:"emmetInsertLineBreak","Ctrl-Space":"autocomplete"}},s={listeners:{},on(r,c){s.listeners[r]||(s.listeners[r]=[]),s.listeners[r].push(c)},emit(r,...c){if(s.listeners[r])for(const p of s.listeners[r])p(...c)},clear(){s.listeners={}}};a.each(async function(){const r=t(this),c=r.attr("name"),p=r.data("tangibleTemplateEditorType"),g={...d,language:p,editorActionsPanel(h,w){return w.eventHub||(w.eventHub=s),R(h,w)}};p==="html"&&(g.emmet={preview:!1});const f=m[c]=await v(this,g);f.setSize(null,"100%"),c==="post_content"&&!b.isNewPost&&f.focus(),this.editor=f,f.save=e,f.codeMirror6&&(f.eventHub=s,y.codeEditors.push({editor:f,$editor:r,fieldName:c,type:p}))})}u(q,"createEditors"),S(q,"createEditors");const I=[["Anonymous Pro","anonymous-pro","anonymous-pro.woff"],["Cascadia Mono","cascadia-mono","CascadiaMono.woff2"],["Cousine","cousine","cousine-regular.woff"],["Droid Sans Mono","droid-sans-mono","droid-sans-mono.woff2"],["Fira Code","fira-code","FiraCode-Regular.woff2"],["JetBrains Mono","jetbrains-mono","JetBrainsMono-Regular.woff2"],["Menlo","menlo","menlo-regular.woff2"],["Monaspace Neon","monaspace-neon","MonaspaceNeon-Regular.woff"],["Monaspace Xenon","monaspace-xenon","MonaspaceXenon-Regular.woff"],["MonoLisa","monolisa","monolisa-regular.woff2"],["Noto Mono","noto-mono","noto-mono.woff2"],["Office Code Pro","office-code-pro","office-code-pro.woff"],["Operator Mono","operator-mono","operator-mono-medium.woff2"],["SF Mono","sf-mono","sf-mono-regular.woff2"],["Source Code Pro","source-code-pro","SourceCodePro-Regular.woff2"]],$={};async function H(t){if($[t]){$[t]instanceof Promise&&await $[t];return}$[t]=(async()=>{const{editorUrl:e}=window.Tangible;if(e)for(const[a,m,v]of I){if(t!==m)continue;const b=`${e}/fonts/${v}`,y=new FontFace(m,`url(${b})`);await y.load(),document.fonts.add(y),$[t]=!0;break}})(),await $[t]}u(H,"C"),S(H,"loadFont");function A(t){const e=t.replace(/([A-Z])/g," $1");return e.charAt(0).toUpperCase()+e.slice(1)}u(A,"T"),S(A,"camelCaseToTitle");const L='SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace';function R(t,e){const a=document.createElement("div"),{themes:m={}}=e,v=Object.keys(m).sort().filter(o=>o!=="dark").map(o=>({label:A(o),value:o}));let{theme:b,fontFamily:y,fontSize:d}=F;a.style.backgroundColor="#4c566a",a.style.color="#fff",a.style.padding=".125rem .5rem",a.style.display="flex",a.style.userSelect="none",a.innerHTML=`<div style="flex-grow: 1;"></div><div style="display: flex; text-align:right">
  <div data-action="settings-group" style="display: none; flex-grow: 1;">

    <div data-action="font" style="margin: 0 4px">Font</div>
    <select data-action="font-list" style="margin: 0; padding: 2px 4px; background-color: #2e3440; color: #fff; min-height: 0; border: 0; box-shadow: none; font-size: 12px; line-height: 1">
      <option value="default">Default</option>
      ${I.map(([o,n])=>`<option value="${n}"${n===y?" selected":""}>${o}</option>`)}
    </select>
    <div data-action="font-size" style="padding: 0 4px;">
      <span data-action="font-size-minus" style="cursor: pointer; padding: 2px 4px">-</span>
      <span data-action="font-size-display">${d}</span>
      <span data-action="font-size-plus" style="cursor: pointer; padding: 2px 4px">+</span>
    </div>

    <div data-action="theme" style="margin: 0 4px">Theme</div>
    <select data-action="theme-list" style="margin: 0; padding: 2px 4px; background-color: #2e3440; color: #fff; min-height: 0; border: 0; box-shadow: none; font-size: 12px; line-height: 1">
      <option value="dark">Default</option>
      ${v.map(({label:o,value:n})=>`<option value="${n}"${n===b?" selected":""}>${o}</option>`)}
    </select>

  </div>
  <div data-action="settings" style="margin: 0 4px; cursor: pointer;">Settings</div>
  <div data-action="format" style="margin: 0 4px; cursor: pointer">Format</div>
</div>`,a.querySelector("[data-action=format]")?.addEventListener("click",function(){e.format&&e.format()});const s=a.querySelector("[data-action=settings-group]");function r(o,n=!1){s.style.display=o?"flex":"none",n&&e.eventHub.emit("settingsVisibility",o,e)}u(r,"a"),S(r,"setSettingsVisibility"),a.querySelector("[data-action=settings]")?.addEventListener("click",function(){r(s.style.display==="none",!0)}),e.eventHub.on("settingsVisibility",function(o,n){n!==e&&r(o)}),t.dom.style.opacity="0",t.dom.style.transition="opacity .3s",setTimeout(()=>{t.dom.style.opacity="1"},0);const c=a.querySelector("[data-action=theme-list]");function p(o,n=!1){m[o]&&(e.setTheme(m[o]),n&&(E({theme:o}),e.eventHub.emit("theme",o,e)))}u(p,"l"),S(p,"selectTheme"),c?.addEventListener("change",function(o){const n=o.target.value;p(n,!0)}),e.eventHub.on("theme",function(o,n){n!==e&&(c.value=o,p(o))}),b!=="dark"&&setTimeout(()=>{p(b)},0);const g=a.querySelector("[data-action=font-list]");a.querySelector("[data-action=font-size]");async function f(o,n=!1){const T=t.dom.querySelector(".cm-content");if(!T)return;const z=o==="default";try{z||await H(o)}catch{return}T.style.fontFamily=z?L:`'${o}', ${L}`,n&&(E({fontFamily:o}),e.eventHub.emit("fontFamily",o,e))}u(f,"b"),S(f,"selectFontFamily"),y!=="default"&&setTimeout(()=>f(y),0),g?.addEventListener("change",function(o){const n=o.target.value;f(n,!0)}),e.eventHub.on("fontFamily",function(o,n){n!==e&&(g.value=o,f(o))});const h=a.querySelector("[data-action=font-size-display]");function w(o,n=!1){const T=t.dom.querySelector(".cm-content");T&&(T.style.fontSize=`${o}px`,h.innerText=o+"",n&&(E({fontSize:o}),e.eventHub.emit("fontSize",o,e)))}return u(w,"S"),S(w,"selectFontSize"),setTimeout(()=>w(d),0),a.querySelector("[data-action=font-size-minus]").addEventListener("click",function(){d>10&&(d--,w(d,!0))}),a.querySelector("[data-action=font-size-plus]").addEventListener("click",function(){d<100&&(d++,w(d,!0))}),e.eventHub.on("fontSize",function(o,n){n!==e&&w(o)}),{top:!0,dom:a}}u(R,"E$1"),S(R,"editorActionsPanel");var X=Object.defineProperty,M=u((t,e)=>X(t,"name",{value:e,configurable:!0}),"s");window.jQuery(function(t){const e=t("#post"),a=e.find("[data-tangible-template-editor-type]");if(!a.length){console.warn("No editor elements found for Tangible Template code editor");return}const{wp:m}=window;m&&m.autosave&&m.autosave.server&&m.autosave.server.postChanged&&(m.autosave.server.postChanged=function(){return!1});const{Tangible:v}=window,{ajax:b,createCodeEditor:y}=v;v.codeEditors=[];const d={},s=t("#post_ID").val(),r=e.find('input[name="post_title"]'),c=t("#publish"),p=c.closest("#major-publishing-actions"),g=e.find("#tangible-template-editor-meta").data("json")||{},f=["name","assets","location","theme_position","theme_header","theme_footer","universal_id"],h={};for(const l of f){const i=e.find(`[name="${l}"]`);i.length&&(h[l]=i)}const w=["tangible_template_category"],o={};for(const l of w){const i=e.find(`[type="checkbox"][name="tax_input[${l}][]"]`);i.length&&(o[l]=i,i.each(function(){const x=this.getAttribute("checked")==="checked";t(this).prop("checked",x)}))}const n=M(function(l,i=""){c.val(l),i?p.append(`<div id="post-save-error-message" style="padding-top: 8px">${i}</div>`):p.find("#post-save-error-message").remove()},"updatePublishButton"),T=M(function(){const l={};for(let i in d){const x=d[i];i==="post_content"&&(i="content");const C=x.getValue();l[i]=C}return l},"getEditorFields"),z=M(function(){const l={};for(const i of f)h[i]&&(l[i]=h[i].val());return l},"getAdditionalFields"),K=M(function(){const l={};for(const i of w)o[i]&&(l[i]=[],o[i].each(function(){const x=t(this);x.prop("checked")&&l[i].push(x.val())}));return l},"getTaxonomyFields");function D(){if(g.isNewPost){c.click();return}if(!s)return;const l=r.val();if(!l)return;const i={title:l,id:s,content:"",...T(),...z(),tax_input:K()},x=c.val();let C;function _(){C&&clearTimeout(C),C=setTimeout(function(){c.val(x)},7e3)}u(_,"w"),M(_,"restorePreviousLabelAfterTimeout"),b("tangible_template_editor_save",i).then(function(V){n("Saved"),_()}).catch(function(V){n("Error",V.message),_()})}u(D,"j"),M(D,"save"),!g.isNewPost&&g.postStatus,q({$:t,save:D,$editors:a,editorInstances:d,createCodeEditor:y,templateMeta:g,Tangible:v}),O({$:t,postId:s,$postForm:e,editorInstances:d})})})();
//# sourceMappingURL=template-editor.min.js.map
