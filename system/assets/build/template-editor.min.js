var K=Object.defineProperty;var p=(d,m)=>K(d,"name",{value:m,configurable:!0});(function(){"use strict";(function(){const o={env:{NODE_ENV:"production"}};try{if(process){process.env=Object.assign({},process.env),Object.assign(process.env,o);return}}catch(n){}globalThis.process={env:o}})();var d=Object.defineProperty,m=Object.defineProperties,C=Object.getOwnPropertyDescriptors,_=Object.getOwnPropertySymbols,F=Object.prototype.hasOwnProperty,L=Object.prototype.propertyIsEnumerable,T=p((o,n,s)=>n in o?d(o,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):o[n]=s,"F"),h=p((o,n)=>{for(var s in n||(n={}))F.call(n,s)&&T(o,s,n[s]);if(_)for(var s of _(n))L.call(n,s)&&T(o,s,n[s]);return o},"p"),j=p((o,n)=>m(o,C(n)),"v"),l=p((o,n)=>d(o,"name",{value:n,configurable:!0}),"r");jQuery(function(o){const n=o("#post"),s=n.find("[data-tangible-template-editor-type]");s.length||console.warn("No editor elements found for Tangible Template code editor");const f={},O=o("#post_ID").val(),$=n.find('input[name="post_title"]'),u=o("#publish"),P=u.closest("#major-publishing-actions"),b=n.find("#tangible-template-editor-meta").data("json")||{},{ajax:D,createCodeEditor:I}=window.Tangible,E=["name","assets","location","theme_position","theme_header","theme_footer","universal_id"],g={};for(const t of E){const e=n.find(`[name="${t}"]`);e.length&&(g[t]=e)}const k=["tangible_template_category"],v={};for(const t of k){const e=n.find(`[type="checkbox"][name="tax_input[${t}][]"]`);e.length&&(v[t]=e,e.each(function(){const i=this.getAttribute("checked")==="checked";o(this).prop("checked",i)}))}const x=l(function(t,e){u.val(t),e?P.append(`<div id="post-save-error-message" style="padding-top: 8px">${e}</div>`):P.find("#post-save-error-message").remove()},"updatePublishButton"),q=l(function(){const t={};for(let e in f){const i=f[e];e==="post_content"&&(e="content");const a=i.getValue();t[e]=a}return t},"getEditorFields"),z=l(function(){const t={};for(const e of E)!g[e]||(t[e]=g[e].val());return t},"getAdditionalFields"),B=l(function(){const t={};for(const e of k)!v[e]||(t[e]=[],v[e].each(function(){const i=o(this);i.prop("checked")&&t[e].push(i.val())}));return t},"getTaxonomyFields"),N=l(function(){if(b.isNewPost){u.click();return}if(!O)return;const t=$.val();if(!t)return;const e=j(h(h({title:t,id:O,content:""},q()),z()),{tax_input:B()}),i=u.val();let a;function r(){a&&clearTimeout(a),a=setTimeout(function(){u.val(i)},7e3)}p(r,"c"),l(r,"restorePreviousLabelAfterTimeout"),D("tangible_template_editor_save",e).then(function(c){x("Saved"),r()}).catch(function(c){x("Error",c.message),r()})},"save");!b.isNewPost&&b.postStatus==="publish"&&(window.onbeforeunload=function(){});const V={viewportMargin:1/0,resizable:!1,lineWrapping:!0,extraKeys:{"Alt-F":"findPersistent","Ctrl-S":N,"Cmd-S":N,Tab:"emmetExpandAbbreviation",Esc:"emmetResetAbbreviation",Enter:"emmetInsertLineBreak","Ctrl-Space":"autocomplete"}};s.each(function(){const t=o(this),e=t.attr("name"),i=t.data("tangibleTemplateEditorType"),a=j(h({},V),{language:i});i==="html"&&(a.emmet={preview:!1,config:{html:{Loop:"Loop[type]",Field:"Field/"}}});const r=f[e]=I(this,a);r.setSize(null,"100%"),e==="post_content"&&!b.isNewPost&&r.focus()});const w=n.find(".tangible-template-tab-selector"),S=n.find(".tangible-template-tab"),A=[];if(!S.length){console.warn("No tabs elements found for Tangible Template code editor");return}w.on("click",function(){const t=this;w.each(function(e){const i=o(this),a=S.eq(e);if(this!==t){i.removeClass("active"),a.hide();return}i.addClass("active"),a.show();const r=a.find("[data-tangible-template-editor-type]"),c=r.length?f[r.attr("name")]:!1;A[e]||(A[e]=!0,c&&c.refresh()),c&&c.focus()})});const y=window.location.search.substr(1).split("&").reduce(function(t,e){const[i,a]=e.split("=");return t[i]=a,t},{});if(y.tab){const t=w.filter(`[data-tab-name="${y.tab}"]`);t.length?t.eq(0).click():console.warn("Tab not found",y.tab)}})})();
//# sourceMappingURL=template-editor.min.js.map
