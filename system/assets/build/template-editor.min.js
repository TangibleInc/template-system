var R=Object.defineProperty;var l=(f,g)=>R(f,"name",{value:g,configurable:!0});(function(){"use strict";(function(){const n={env:{NODE_ENV:"production"}};try{if(process){process.env=Object.assign({},process.env),Object.assign(process.env,n);return}}catch(o){}globalThis.process={env:n}})();var f=Object.defineProperty,g=Object.defineProperties,$=Object.getOwnPropertyDescriptors,_=Object.getOwnPropertySymbols,D=Object.prototype.hasOwnProperty,M=Object.prototype.propertyIsEnumerable,j=l((n,o,r)=>o in n?f(n,o,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[o]=r,"F"),h=l((n,o)=>{for(var r in o||(o={}))D.call(o,r)&&j(n,r,o[r]);if(_)for(var r of _(o))M.call(o,r)&&j(n,r,o[r]);return n},"p"),S=l((n,o)=>g(n,$(o)),"v"),c=l((n,o)=>f(n,"name",{value:o,configurable:!0}),"c");const T="tangibleTemplateEditorState",v=Object.assign({tab:void 0},P()||{});function E(n){!window.localStorage||(window.localStorage.setItem(T,JSON.stringify(n)),Object.assign(v,n))}l(E,"D"),c(E,"setMemory");function P(){if(!window.localStorage)return;let n=window.localStorage.getItem(T);if(n)try{return n=JSON.parse(n),n}catch(o){}}l(P,"Q"),c(P,"getMemory"),jQuery(function(n){const o=n("#post"),r=o.find("[data-tangible-template-editor-type]");r.length||console.warn("No editor elements found for Tangible Template code editor");const u={},m=n("#post_ID").val(),q=o.find('input[name="post_title"]'),d=n("#publish"),N=d.closest("#major-publishing-actions"),b=o.find("#tangible-template-editor-meta").data("json")||{},{ajax:z,createCodeEditor:B}=window.Tangible,k=["name","assets","location","theme_position","theme_header","theme_footer","universal_id"],w={};for(const t of k){const e=o.find(`[name="${t}"]`);e.length&&(w[t]=e)}const x=["tangible_template_category"],y={};for(const t of x){const e=o.find(`[type="checkbox"][name="tax_input[${t}][]"]`);e.length&&(y[t]=e,e.each(function(){const i=this.getAttribute("checked")==="checked";n(this).prop("checked",i)}))}const I=c(function(t,e){d.val(t),e?N.append(`<div id="post-save-error-message" style="padding-top: 8px">${e}</div>`):N.find("#post-save-error-message").remove()},"updatePublishButton"),J=c(function(){const t={};for(let e in u){const i=u[e];e==="post_content"&&(e="content");const a=i.getValue();t[e]=a}return t},"getEditorFields"),K=c(function(){const t={};for(const e of k)!w[e]||(t[e]=w[e].val());return t},"getAdditionalFields"),Q=c(function(){const t={};for(const e of x)!y[e]||(t[e]=[],y[e].each(function(){const i=n(this);i.prop("checked")&&t[e].push(i.val())}));return t},"getTaxonomyFields"),A=c(function(){if(b.isNewPost){d.click();return}if(!m)return;const t=q.val();if(!t)return;const e=S(h(h({title:t,id:m,content:""},J()),K()),{tax_input:Q()}),i=d.val();let a;function s(){a&&clearTimeout(a),a=setTimeout(function(){d.val(i)},7e3)}l(s,"r"),c(s,"restorePreviousLabelAfterTimeout"),z("tangible_template_editor_save",e).then(function(p){I("Saved"),s()}).catch(function(p){I("Error",p.message),s()})},"save");!b.isNewPost&&b.postStatus;const V={viewportMargin:1/0,resizable:!1,lineWrapping:!0,extraKeys:{"Alt-F":"findPersistent","Ctrl-S":A,"Cmd-S":A,Tab:"emmetExpandAbbreviation",Esc:"emmetResetAbbreviation",Enter:"emmetInsertLineBreak","Ctrl-Space":"autocomplete"}};r.each(function(){const t=n(this),e=t.attr("name"),i=t.data("tangibleTemplateEditorType"),a=S(h({},V),{language:i});i==="html"&&(a.emmet={preview:!1,config:{html:{Loop:"Loop[type]",Field:"Field/"}}});const s=u[e]=B(this,a);s.setSize(null,"100%"),e==="post_content"&&!b.isNewPost&&s.focus()});const O=o.find(".tangible-template-tab-selector"),C=o.find(".tangible-template-tab"),F=[];if(!C.length){console.warn("No tabs elements found for Tangible Template code editor");return}O.on("click",function(){const t=this;O.each(function(e){const i=n(this),a=C.eq(e);if(this!==t){i.removeClass("active"),a.hide();return}i.addClass("active"),a.show();const s=a.find("[data-tangible-template-editor-type]"),p=s.length?u[s.attr("name")]:!1;F[e]||(F[e]=!0,p&&p.refresh()),p&&p.focus(),E({tab:i.data("tabName"),postId:m})})});const L=window.location.search.substr(1).split("&").reduce(function(t,e){const[i,a]=e.split("=");return t[i]=a,t},{}).tab||v.postId===m&&v.tab;if(L){const t=O.filter(`[data-tab-name="${L}"]`);t.length&&t.eq(0).click()}})})();
//# sourceMappingURL=template-editor.min.js.map
