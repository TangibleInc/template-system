var D=Object.defineProperty;var c=(w,h)=>D(w,"name",{value:h,configurable:!0});(function(){"use strict";(function(){const n={NODE_ENV:"production"};try{if(process){process.env=Object.assign({},process.env),Object.assign(process.env,n);return}}catch{}globalThis.process={env:n}})();var w=Object.defineProperty,h=c((n,a)=>w(n,"name",{value:a,configurable:!0}),"i");async function N(n,a={}){const{CodeEditor:g}=window.Tangible.TemplateSystem||{};if(!g)throw new Error("CodeEditor not found");const{language:d="html",onSave:u}=a,r=await g.create({lang:d,content:n.value,onSave(){u&&(p(),u())}});function p(){n.value=r.view.state.doc.toString()}return c(p,"n"),h(p,"updateTextarea"),n.parentNode?.insertBefore(r.view.dom,n),n.form&&n.form.addEventListener("submit",()=>p()),{getValue(){return r.view.state.doc.toString()},focus(){r.view.focus()},refresh(){},setSize(m,S){},updateTextarea:p}}c(N,"createTemplateEditor"),h(N,"createTemplateEditor");var L=Object.defineProperty,l=c((n,a)=>L(n,"name",{value:a,configurable:!0}),"c");const j="tangibleTemplateEditorState",y=Object.assign({tab:void 0},C()||{});function x(n){window.localStorage&&(window.localStorage.setItem(j,JSON.stringify(n)),Object.assign(y,n))}c(x,"q"),l(x,"setMemory");function C(){if(!window.localStorage)return;let n=window.localStorage.getItem(j);if(n)try{return n=JSON.parse(n),n}catch{}}c(C,"B"),l(C,"getMemory"),jQuery(function(n){const a=n("#post"),g=a.find("[data-tangible-template-editor-type]");g.length||console.warn("No editor elements found for Tangible Template code editor");const{wp:d}=window;d&&d.autosave&&d.autosave.server&&d.autosave.server.postChanged&&(d.autosave.server.postChanged=function(){return!1});const u={},r=n("#post_ID").val(),p=a.find('input[name="post_title"]'),m=n("#publish"),S=m.closest("#major-publishing-actions"),b=a.find("#tangible-template-editor-meta").data("json")||{},{ajax:$,createCodeEditor:B=N}=window.Tangible,k=["name","assets","location","theme_position","theme_header","theme_footer","universal_id"],T={};for(const t of k){const e=a.find(`[name="${t}"]`);e.length&&(T[t]=e)}const O=["tangible_template_category"],E={};for(const t of O){const e=a.find(`[type="checkbox"][name="tax_input[${t}][]"]`);e.length&&(E[t]=e,e.each(function(){const o=this.getAttribute("checked")==="checked";n(this).prop("checked",o)}))}const P=l(function(t,e){m.val(t),e?S.append(`<div id="post-save-error-message" style="padding-top: 8px">${e}</div>`):S.find("#post-save-error-message").remove()},"updatePublishButton"),q=l(function(){const t={};for(let e in u){const o=u[e];e==="post_content"&&(e="content");const i=o.getValue();t[e]=i}return t},"getEditorFields"),z=l(function(){const t={};for(const e of k)T[e]&&(t[e]=T[e].val());return t},"getAdditionalFields"),M=l(function(){const t={};for(const e of O)E[e]&&(t[e]=[],E[e].each(function(){const o=n(this);o.prop("checked")&&t[e].push(o.val())}));return t},"getTaxonomyFields");function v(){if(b.isNewPost){m.click();return}if(!r)return;const t=p.val();if(!t)return;const e={title:t,id:r,content:"",...q(),...z(),tax_input:M()},o=m.val();let i;function s(){i&&clearTimeout(i),i=setTimeout(function(){m.val(o)},7e3)}c(s,"s"),l(s,"restorePreviousLabelAfterTimeout"),$("tangible_template_editor_save",e).then(function(f){P("Saved"),s()}).catch(function(f){P("Error",f.message),s()})}c(v,"p"),l(v,"save"),!b.isNewPost&&b.postStatus;const V={onSave:v,viewportMargin:1/0,resizable:!1,lineWrapping:!0,extraKeys:{"Alt-F":"findPersistent","Ctrl-S":v,"Cmd-S":v,Tab:"emmetExpandAbbreviation",Esc:"emmetResetAbbreviation",Enter:"emmetInsertLineBreak","Ctrl-Space":"autocomplete"}};g.each(async function(){const t=n(this),e=t.attr("name"),o=t.data("tangibleTemplateEditorType"),i={...V,language:o};o==="html"&&(i.emmet={preview:!1,config:{html:{Loop:"Loop[type]",Field:"Field/"}}});const s=u[e]=await B(this,i);s.setSize(null,"100%"),e==="post_content"&&!b.isNewPost&&s.focus(),this.editor=s,s.save=v});const _=a.find(".tangible-template-tab-selector"),A=a.find(".tangible-template-tab"),F=[];if(!A.length){console.warn("No tabs elements found for Tangible Template code editor");return}_.on("click",function(){const t=this;_.each(function(e){const o=n(this),i=A.eq(e);if(this!==t){o.removeClass("active"),i.hide();return}o.addClass("active"),i.show();const s=i.find("[data-tangible-template-editor-type]"),f=s.length?u[s.attr("name")]:!1;F[e]||(F[e]=!0,f&&f.refresh()),f&&f.focus(),x({tab:o.data("tabName"),postId:r})})});const I=window.location.search.substr(1).split("&").reduce(function(t,e){const[o,i]=e.split("=");return t[o]=i,t},{}).tab||y.postId===r&&y.tab;if(I){const t=_.filter(`[data-tab-name="${I}"]`);t.length&&t.eq(0).click()}})})();
//# sourceMappingURL=template-editor.min.js.map
